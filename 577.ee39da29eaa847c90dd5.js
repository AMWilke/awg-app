(self.webpackChunkawg_app=self.webpackChunkawg_app||[]).push([[577],{6917:(e,t,n)=>{!function(e){"use strict";e.defineMode("sparql",function(e){var t,n=e.indentUnit;function r(e){return new RegExp("^(?:"+e.join("|")+")$","i")}var i=r(["str","lang","langmatches","datatype","bound","sameterm","isiri","isuri","iri","uri","bnode","count","sum","min","max","avg","sample","group_concat","rand","abs","ceil","floor","round","concat","substr","strlen","replace","ucase","lcase","encode_for_uri","contains","strstarts","strends","strbefore","strafter","year","month","day","hours","minutes","seconds","timezone","tz","now","uuid","struuid","md5","sha1","sha256","sha384","sha512","coalesce","if","strlang","strdt","isnumeric","regex","exists","isblank","isliteral","a","bind"]),s=r(["base","prefix","select","distinct","reduced","construct","describe","ask","from","named","where","order","limit","offset","filter","optional","graph","by","asc","desc","as","having","undef","values","group","minus","in","not","service","silent","using","insert","delete","union","true","false","with","data","copy","to","move","add","create","drop","clear","load"]),a=/[*+\-<>=&|\^\/!\?]/;function o(e,n){var r=e.next();if(t=null,"$"==r||"?"==r)return"?"==r&&e.match(/\s/,!1)?"operator":(e.match(/^[A-Za-z0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][A-Za-z0-9_\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]*/),"variable-2");if("<"!=r||e.match(/^[\s\u00a0=]/,!1)){if('"'==r||"'"==r)return n.tokenize=l(r),n.tokenize(e,n);if(/[{}\(\),\.;\[\]]/.test(r))return t=r,"bracket";if("#"==r)return e.skipToEnd(),"comment";if("^"===r)return"^"===(r=e.peek())?e.eat("^"):e.eatWhile(a),"operator";if(a.test(r))return e.eatWhile(a),"operator";if(":"==r)return u(e),"atom";if("@"==r)return e.eatWhile(/[a-z\d\-]/i),"meta";if(e.eatWhile(/[_\w\d]/),e.eat(":"))return u(e),"atom";var o=e.current();return i.test(o)?"builtin":s.test(o)?"keyword":"variable"}return e.match(/^[^\s\u00a0>]*>?/),"atom"}function u(e){e.match(/(\.(?=[\w_\-\\%])|[:\w_-]|\\[-\\_~.!$&'()*+,;=/?#@%]|%[a-f\d][a-f\d])+/i)}function l(e){return function(t,n){for(var r,i=!1;null!=(r=t.next());){if(r==e&&!i){n.tokenize=o;break}i=!i&&"\\"==r}return"string"}}function c(e,t,n){e.context={prev:e.context,indent:e.indent,col:n,type:t}}function h(e){e.indent=e.context.indent,e.context=e.context.prev}return{startState:function(){return{tokenize:o,context:null,indent:0,col:0}},token:function(e,n){if(e.sol()&&(n.context&&null==n.context.align&&(n.context.align=!1),n.indent=e.indentation()),e.eatSpace())return null;var r=n.tokenize(e,n);if("comment"!=r&&n.context&&null==n.context.align&&"pattern"!=n.context.type&&(n.context.align=!0),"("==t)c(n,")",e.column());else if("["==t)c(n,"]",e.column());else if("{"==t)c(n,"}",e.column());else if(/[\]\}\)]/.test(t)){for(;n.context&&"pattern"==n.context.type;)h(n);n.context&&t==n.context.type&&(h(n),"}"==t&&n.context&&"pattern"==n.context.type&&h(n))}else"."==t&&n.context&&"pattern"==n.context.type?h(n):/atom|string|variable/.test(r)&&n.context&&(/[\}\]]/.test(n.context.type)?c(n,"pattern",e.column()):"pattern"!=n.context.type||n.context.align||(n.context.align=!0,n.context.col=e.column()));return r},indent:function(e,t){var r=t&&t.charAt(0),i=e.context;if(/[\]\}]/.test(r))for(;i&&"pattern"==i.type;)i=i.prev;var s=i&&r==i.type;return i?"pattern"==i.type?i.col:i.align?i.col+(s?0:1):i.indent+(s?0:n):0},lineComment:"#"}}),e.defineMIME("application/sparql-query","sparql")}(n(7476))},1006:(e,t,n)=>{!function(e){"use strict";e.defineMode("turtle",function(e){var t,n=e.indentUnit;function r(e){return new RegExp("^(?:"+e.join("|")+")$","i")}r([]);var i=r(["@prefix","@base","a"]),s=/[*+\-<>=&|]/;function a(e,n){var r=e.next();if(t=null,"<"!=r||e.match(/^[\s\u00a0=]/,!1)){if('"'==r||"'"==r)return n.tokenize=o(r),n.tokenize(e,n);if(/[{}\(\),\.;\[\]]/.test(r))return t=r,null;if("#"==r)return e.skipToEnd(),"comment";if(s.test(r))return e.eatWhile(s),null;if(":"==r)return"operator";if(e.eatWhile(/[_\w\d]/),":"==e.peek())return"variable-3";var a=e.current();return i.test(a)?"meta":r>="A"&&r<="Z"?"comment":"keyword"}return e.match(/^[^\s\u00a0>]*>?/),"atom"}function o(e){return function(t,n){for(var r,i=!1;null!=(r=t.next());){if(r==e&&!i){n.tokenize=a;break}i=!i&&"\\"==r}return"string"}}function u(e,t,n){e.context={prev:e.context,indent:e.indent,col:n,type:t}}function l(e){e.indent=e.context.indent,e.context=e.context.prev}return{startState:function(){return{tokenize:a,context:null,indent:0,col:0}},token:function(e,n){if(e.sol()&&(n.context&&null==n.context.align&&(n.context.align=!1),n.indent=e.indentation()),e.eatSpace())return null;var r=n.tokenize(e,n);if("comment"!=r&&n.context&&null==n.context.align&&"pattern"!=n.context.type&&(n.context.align=!0),"("==t)u(n,")",e.column());else if("["==t)u(n,"]",e.column());else if("{"==t)u(n,"}",e.column());else if(/[\]\}\)]/.test(t)){for(;n.context&&"pattern"==n.context.type;)l(n);n.context&&t==n.context.type&&l(n)}else"."==t&&n.context&&"pattern"==n.context.type?l(n):/atom|string|variable/.test(r)&&n.context&&(/[\}\]]/.test(n.context.type)?u(n,"pattern",e.column()):"pattern"!=n.context.type||n.context.align||(n.context.align=!0,n.context.col=e.column()));return r},indent:function(e,t){var r=t&&t.charAt(0),i=e.context;if(/[\]\}]/.test(r))for(;i&&"pattern"==i.type;)i=i.prev;var s=i&&r==i.type;return i?"pattern"==i.type?i.col:i.align?i.col+(s?0:1):i.indent+(s?0:n):0},lineComment:"#"}}),e.defineMIME("text/turtle","turtle")}(n(7476))},653:e=>{let t;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:global):e=>(t||(t=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},1577:(e,t,n)=>{"use strict";n.r(t),n.d(t,{EditionGraphModule:()=>$i});var r=n(4762),i=n(7716),s=n(1470);let a=class{constructor(){this.clickedNodeRequest=new i.vpe}ngOnInit(){}onGraphNodeClick(e){e&&this.clickedNodeRequest.emit(e)}};a.propDecorators={queryResult$:[{type:i.IIB}],defaultForceGraphHeight:[{type:i.IIB}],clickedNodeRequest:[{type:i.r_U}]},a=(0,r.gn)([(0,i.wA2)({selector:"awg-construct-results",template:'<ngb-accordion activeIds="awg-graph-visualizer-construct-result">\n    <ngb-panel id="awg-graph-visualizer-construct-result" title="Resultat">\n        <ng-template ngbPanelContent>\n            <ng-container *ngIf="queryResult$ | async as queryResult; else loading">\n                <ng-container *ngIf="queryResult.length > 0; else noResult">\n                    \x3c!-- Force graph visualization --\x3e\n                    <awg-force-graph\n                        class="full-width"\n                        [queryResultTriples]="queryResult"\n                        [height]="defaultForceGraphHeight"\n                        (clickedNodeRequest)="onGraphNodeClick($event)"\n                    >\n                    </awg-force-graph>\n                </ng-container>\n                <ng-template #noResult>\n                    <awg-sparql-no-results></awg-sparql-no-results>\n                </ng-template>\n            </ng-container>\n            <ng-template #loading>\n                <awg-twelve-tone-spinner></awg-twelve-tone-spinner>\n            </ng-template>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:i.n4l.OnPush,styles:[""]})],a);var o=n(9765),u=n(4395),l=n(6782),c=n(9976);class h{constructor(){this.nodes=[],this.links=[],this.nodeTriples=[]}}class p{constructor(e,t){this.source=e,this.target=t,this.predicate="",this.weight=1}}var f,d;!function(e){e.link="link",e.node="node"}(f||(f={}));class g{constructor(e,t){this.id=e,this.label=e,this.weight=1,this.type=t,this.owlClass=!1,this.instance=!1}}class _{constructor(e,t,n){this.nodeSubject=e,this.nodePredicate=t,this.nodeObject=n}}!function(e){e.short="short",e.long="long"}(d||(d={}));class y{constructor(e,t){this.prefixName=e,this.prefixIri=t}}var m,b=n(5917);class v{constructor(e){this.header=e.head.vars,this.totalRows$=(0,b.of)(e.body.bindings),this.filteredRows=e.body.bindings,this.paginatedRows$=(0,b.of)(e.body.bindings)}}class x{constructor(e,t,n,r){this.page=e,this.pageSize=t,this.pageSizeOptions=n,this.collectionSize=r}}!function(e){e.CASE_SENSITIVE="case-sensitive",e.CASE_INSENSITIVE="case-insensitive"}(m||(m={}));let w=class{constructor(){this.prefixes=[new y("awg","https://edition.anton-webern.ch/webern-onto#"),new y("dc","http://purl.org/dc/elements/1.1/"),new y("owl","http://www.w3.org/2002/07/owl#"),new y("prov","http://www.w3.org/ns/prov#"),new y("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),new y("rdfs","http://www.w3.org/2000/01/rdf-schema#"),new y("xsd","http://www.w3.org/2001/XMLSchema#")]}transform(e,t){let n=e;const r=this._switchPrefixForm(n,t);return r&&(n=r),n}_switchPrefixForm(e,t){let n;switch(t){case d.short:this.prefixes.map(t=>{-1!==e.indexOf(t.prefixIri)&&(n=e.replace(t.prefixIri,t.prefixName+":"))});break;case d.long:this.prefixes.map(t=>{-1!==e.indexOf(t.prefixName)&&(n=e.replace(t.prefixName+":",t.prefixIri))})}return n}};w=(0,r.gn)([(0,i.E6H)({name:"prefix",pure:!1})],w);const k="http://www.w3.org/1999/02/22-rdf-syntax-ns#",R="http://www.w3.org/2001/XMLSchema#",q="http://www.w3.org/2000/10/swap/",S={xsd:{decimal:`${R}decimal`,boolean:`${R}boolean`,double:`${R}double`,integer:`${R}integer`,string:`${R}string`},rdf:{type:`${k}type`,nil:`${k}nil`,first:`${k}first`,rest:`${k}rest`,langString:`${k}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${q}reify#forSome`,forAll:`${q}reify#forAll`},log:{implies:`${q}log#implies`}};var T=n(653),I=n.n(T);const{xsd:N}=S,E=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,C={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},z=/[\x00-\x20<>\\"\{\}\|\^\`]/,F={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},A=/$0^/;class P{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const e in this)!(e in F)&&this[e]instanceof RegExp&&(this[e]=A)}else this._n3Mode=!1!==e.n3;this._comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,t){let n=this._input;const r=this._comments;for(;;){let s,a;for(;s=this._newline.exec(n);)r&&(a=this._comment.exec(s[0]))&&e(null,{line:this._line,type:"comment",value:a[1],prefix:""}),n=n.substr(s[0].length,n.length),this._line++;if(!s&&(s=this._whitespace.exec(n))&&(n=n.substr(s[0].length,n.length)),this._endOfFile.test(n))return t&&(r&&(a=this._comment.exec(n))&&e(null,{line:this._line,type:"comment",value:a[1],prefix:""}),e(n=null,{line:this._line,type:"eof",value:"",prefix:""})),this._input=n;const o=this._line,u=n[0];let l="",c="",h="",p=null,f=0,d=!1;switch(u){case"^":if(n.length<3)break;if("^"!==n[1]){this._n3Mode&&(f=1,l="^");break}if(this._previousMarker="^^",n=n.substr(2),"<"!==n[0]){d=!0;break}case"<":if(p=this._unescapedIri.exec(n))l="IRI",c=p[1];else if(p=this._iri.exec(n)){if(c=this._unescape(p[1]),null===c||z.test(c))return i(this);l="IRI"}else n.length>1&&"<"===n[1]?(l="<<",f=2):this._n3Mode&&n.length>1&&"="===n[1]&&(l="inverse",f=2,c=">");break;case">":n.length>1&&">"===n[1]&&(l=">>",f=2);break;case"_":((p=this._blank.exec(n))||t&&(p=this._blank.exec(`${n} `)))&&(l="blank",h="_",c=p[1]);break;case'"':if(p=this._simpleQuotedString.exec(n))c=p[1];else if(({value:c,matchLength:f}=this._parseLiteral(n)),null===c)return i(this);null===p&&0===f||(l="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(p=this._simpleApostropheString.exec(n))c=p[1];else if(({value:c,matchLength:f}=this._parseLiteral(n)),null===c)return i(this);null===p&&0===f||(l="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(p=this._variable.exec(n))&&(l="var",c=p[0]);break;case"@":"literal"===this._previousMarker&&(p=this._langcode.exec(n))?(l="langcode",c=p[1]):(p=this._keyword.exec(n))&&(l=p[0]);break;case".":if(1===n.length?t:n[1]<"0"||n[1]>"9"){l=".",f=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(p=this._number.exec(n)||t&&(p=this._number.exec(`${n} `)))&&(l="literal",c=p[0],h="string"==typeof p[1]?N.double:"string"==typeof p[2]?N.decimal:N.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(p=this._sparqlKeyword.exec(n))?l=p[0].toUpperCase():d=!0;break;case"f":case"t":(p=this._boolean.exec(n))?(l="literal",c=p[0],h=N.boolean):d=!0;break;case"a":(p=this._shortPredicates.exec(n))?(l="abbreviation",c="a"):d=!0;break;case"=":this._n3Mode&&n.length>1&&(l="abbreviation",">"!==n[1]?(f=1,c="="):(f=2,c=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":this._lineMode||(f=1,l=u);break;default:d=!0}if(d&&("@prefix"!==this._previousMarker&&"PREFIX"!==this._previousMarker||!(p=this._prefix.exec(n))?((p=this._prefixed.exec(n))||t&&(p=this._prefixed.exec(`${n} `)))&&(l="prefixed",h=p[1]||"",c=this._unescape(p[2])):(l="prefix",c=p[1]||"")),"^^"===this._previousMarker)switch(l){case"prefixed":l="type";break;case"IRI":l="typeIRI";break;default:l=""}if(!l)return t||!/^'''|^"""/.test(n)&&/\n|\r/.test(n)?i(this):this._input=n;const g={line:o,type:l,value:c,prefix:h};e(null,g),this.previousToken=g,this._previousMarker=l,n=n.substr(f||p[0].length,n.length)}function i(t){e(t._syntaxError(/^\S*/.exec(n)[0]))}}_unescape(e){let t=!1;const n=e.replace(E,(e,n,r,i)=>{if("string"==typeof n)return String.fromCharCode(Number.parseInt(n,16));if("string"==typeof r){let e=Number.parseInt(r,16);return e<=65535?String.fromCharCode(Number.parseInt(r,16)):String.fromCharCode(55296+((e-=65536)>>10),56320+(1023&e))}return i in C?C[i]:(t=!0,"")});return t?null:n}_parseLiteral(e){if(e.length>=3){const t=e.match(/^(?:"""|"|'''|'|)/)[0],n=t.length;let r=Math.max(this._literalClosingPos,n);for(;(r=e.indexOf(t,r))>0;){let t=0;for(;"\\"===e[r-t-1];)t++;if(t%2==0){const t=e.substring(n,r),i=t.split(/\r\n|\r|\n/).length-1,s=r+n;if(1===n&&0!==i||3===n&&this._lineMode)break;return this._line+=i,{value:this._unescape(t),matchLength:s}}r++}this._literalClosingPos=e.length-n+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const t=new Error(`Unexpected "${e}" on line ${this._line}.`);return t.context={token:void 0,line:this._line,previousToken:this.previousToken},t}tokenize(e,t){if(this._line=1,"string"==typeof e){if(this._input=e,"function"!=typeof t){const e=[];let t;if(this._tokenizeToEnd((n,r)=>n?t=n:e.push(r),!0),t)throw t;return e}I()(()=>this._tokenizeToEnd(t,!0))}else this._input="",this._pendingBuffer=null,"function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",e=>{null!==this._input&&0!==e.length&&(this._pendingBuffer&&(e=Buffer.concat([this._pendingBuffer,e]),this._pendingBuffer=null),128&e[e.length-1]?this._pendingBuffer=e:(this._input+=e,this._tokenizeToEnd(t,!1)))}),e.on("end",()=>{null!==this._input&&this._tokenizeToEnd(t,!0)}),e.on("error",t)}}const{rdf:D,xsd:M}=S;let j,O=0;const L={namedNode:function(e){return new G(e)},blankNode:function(e){return new H(e||"n3-"+O++)},variable:function(e){return new V(e)},literal:function(e,t){if("string"==typeof t)return new B(`"${e}"@${t.toLowerCase()}`);let n=t?t.value:"";""===n&&("boolean"==typeof e?n=M.boolean:"number"==typeof e&&(Number.isFinite(e)?n=Number.isInteger(e)?M.integer:M.double:(n=M.double,Number.isNaN(e)||(e=e>0?"INF":"-INF"))));return""===n||n===M.string?new B(`"${e}"`):new B(`"${e}"^^${n}`)},defaultGraph:function(){return j},quad:X,triple:X},$=L;class Q{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof Q?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}toJSON(){return{termType:this.termType,value:this.value}}}class G extends Q{get termType(){return"NamedNode"}}class B extends Q{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let t=e.lastIndexOf('"')+1;return t<e.length&&"@"===e[t++]?e.substr(t).toLowerCase():""}get datatype(){return new G(this.datatypeString)}get datatypeString(){const e=this.id,t=e.lastIndexOf('"')+1,n=t<e.length?e[t]:"";return"^"===n?e.substr(t+2):"@"!==n?M.string:D.langString}equals(e){return e instanceof B?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class H extends Q{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class V extends Q{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}j=new class extends Q{constructor(){return super(""),j||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}};class U extends Q{constructor(e,t,n,r){super(""),this._subject=e,this._predicate=t,this._object=n,this._graph=r||j}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function X(e,t,n,r){return new U(e,t,n,r)}let W=0;class Z{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&Y(this,e.factory);const t="string"==typeof e.format?e.format.match(/\w*$/)[0].toLowerCase():"",n=/turtle/.test(t),r=/trig/.test(t),i=/triple/.test(t),s=/quad/.test(t),a=this._n3Mode=/n3/.test(t),o=i||s;(this._supportsNamedGraphs=!(n||a))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(n||r||i||a),this._supportsRDFStar=""===t||/star|\*$/.test(t),o&&(this._resolveRelativeIRI=e=>null),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new P({lineMode:o,n3:a}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){W=0}_setBase(e){if(e){const t=e.indexOf("#");t>=0&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}else this._base="",this._basePath=""}_saveContext(e,t,n,r,i){const s=this._n3Mode;this._contextStack.push({subject:n,predicate:r,object:i,graph:t,type:e,inverse:!!s&&this._inversePredicate,blankPrefix:s?this._prefixes._:"",quantified:s?this._quantified:null}),s&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.id.substr(2)}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(){const e=this._contextStack.pop(),t=this._n3Mode;this._subject=e.subject,this._predicate=e.predicate,this._object=e.object,this._graph=e.graph,t&&(this._inversePredicate=e.inverse,this._prefixes._=e.blankPrefix,this._quantified=e.quantified)}_readInTopContext(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,t){let n;switch(e.type){case"IRI":case"typeIRI":const t=this._resolveIRI(e.value);if(null===t)return this._error("Invalid IRI",e);n=this._namedNode(t);break;case"type":case"prefixed":const r=this._prefixes[e.prefix];if(void 0===r)return this._error(`Undefined prefix "${e.prefix}:"`,e);n=this._namedNode(r+e.value);break;case"blank":n=this._blankNode(this._prefixes[e.prefix]+e.value);break;case"var":n=this._variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!t&&this._n3Mode&&n.id in this._quantified&&(n=this._quantified[n.id]),n}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier=this._blankNode,this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier=this._variable,this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(0===e.prefix.length)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._literal(e.value,this._namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if(void 0===(this._subject=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return null===this._predicate?this._error(`Unexpected ${t}`,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return null!==this._predicate?this._readPredicate:this._error("Expected predicate but got ;",e);case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if(void 0===(this._predicate=this._readEntity(e)))return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(0===e.prefix.length)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._literal(e.value,this._namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if(void 0===(this._object=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return"{"!==e.type?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._emit(this._subject,this._predicate,this._object,this._graph);const t=null===this._predicate;return this._restoreContext(),null===this._object?t?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank:this._getContextEndReader()}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let t=null,n=null,r=this._readListItem;const i=this._subject,s=this._contextStack,a=s[s.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,n=this._blankNode(),this.RDF_FIRST,this._subject=t=this._blankNode()),r=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,n=this._blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext(),0!==s.length&&"list"===s[s.length-1].type&&this._emit(this._subject,this._predicate,this._object,this._graph),null===this._predicate){if(r=this._readPredicate,this._subject===this.RDF_NIL)return r}else if(r=this._getContextEndReader(),this._object===this.RDF_NIL)return r;n=this.RDF_NIL;break;case"literal":0===e.prefix.length?(this._literalValue=e.value,r=this._readListItemDataTypeOrLang):(t=this._literal(e.value,this._namedNode(e.prefix)),r=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if(void 0===(t=this._readEntity(e)))return}if(null===n&&(this._subject=n=this._blankNode()),null===i?null===a.predicate?a.subject=n:a.object=n:this._emit(i,this.RDF_REST,n,this._graph),null!==t){if(this._n3Mode&&("IRI"===e.type||"prefixed"===e.type))return this._saveContext("item",this._graph,n,this.RDF_FIRST,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);this._emit(n,this.RDF_FIRST,t,this._graph)}return r}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let t=this._literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const n=this._readEntity(e);if(void 0===n)return;t=this._literal(this._literalValue,n),e=null;break;case"langcode":t=this._literal(this._literalValue,e.value),e=null}return{token:e,literal:t}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,t){const n=this._completeLiteral(e);if(n)return this._object=n.literal,t&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),null===n.token?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(n.token))}_readFormulaTail(e){return"}"!==e.type?this._readPunctuation(e):(null!==this._subject&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext(),null===this._object?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let t,n=this._graph;const r=this._subject,i=this._inversePredicate;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,i&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:if(this._supportsQuads&&null===this._graph&&void 0!==(n=this._readEntity(e))){t=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(null!==r){const e=this._predicate,t=this._object;i?this._emit(t,e,r,n):this._emit(r,e,t,n)}return t}_readBlankNodePunctuation(e){let t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),t}_readQuadPunctuation(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if("IRI"!==e.type)return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const t=this._readEntity(e);return this._prefixes[this._prefix]=t.value,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation}_readBaseIRI(e){const t="IRI"===e.type&&this._resolveIRI(e.value);return t?(this._setBase(t),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject=this._blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let t;switch(e.type){case"IRI":case"prefixed":if(void 0!==(t=this._readEntity(e,!0)))break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(null===this._subject?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,t,this.QUANTIFIERS_GRAPH)):this._quantified[t.id]=this._quantifier(this._blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return","===e.type?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const t=this._contextStack,n=t.length&&t[t.length-1];if(n&&"item"===n.type){const e=this._subject;this._restoreContext(),this._emit(this._subject,this.RDF_FIRST,e,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let t,n;const r=this._blankNode();if(void 0!==(n=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=r):(t=this._object,this._object=r),this._emit(t,n,r,this._graph),this._readPath}_readBackwardPath(e){const t=this._blankNode();let n,r;if(void 0!==(n=this._readEntity(e)))return null===this._predicate?(r=this._subject,this._subject=t):(r=this._object,this._object=t),this._emit(t,n,r,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return">>"!==e.type?this._supportsQuads&&null===this._graph&&void 0!==(this._graph=this._readEntity(e))?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(">>"!==e.type)return this._error(`Expected >> but got ${e.type}`,e);const t=this._quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext(),null===this._subject?(this._subject=t,this._readPredicate):(this._object=t,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,t,n,r){this._callback(null,this._quad(e,t,n,r||this.DEFAULTGRAPH))}_error(e,t){const n=new Error(`${e} on line ${t.line}.`);n.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(n),this._callback=K}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return("/"===e[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const t=e.length;let n="",r=-1,i=-1,s=0,a="/";for(;r<t;){switch(a){case":":if(i<0&&"/"===e[++r]&&"/"===e[++r])for(;(i=r+1)<t&&"/"!==e[i];)r=i;break;case"?":case"#":r=t;break;case"/":if("."===e[r+1])switch(a=e[1+ ++r],a){case"/":n+=e.substring(s,r-1),s=r+1;break;case void 0:case"?":case"#":return n+e.substring(s,r)+e.substr(r+1);case".":if(a=e[1+ ++r],void 0===a||"/"===a||"?"===a||"#"===a){if(n+=e.substring(s,r-2),(s=n.lastIndexOf("/"))>=i&&(n=n.substr(0,s)),"/"!==a)return`${n}/${e.substr(r+1)}`;s=r+1}}}a=e[++r]}return n+e.substring(s)}parse(e,t,n){if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${W++}_`,this._prefixCallback=n||K,this._inversePredicate=!1,this._quantified=Object.create(null),!t){const t=[];let n;if(this._callback=(e,r)=>{e?n=e:r&&t.push(r)},this._lexer.tokenize(e).every(e=>this._readCallback=this._readCallback(e)),n)throw n;return t}this._callback=t,this._lexer.tokenize(e,(e,t)=>{null!==e?(this._callback(e),this._callback=K):this._readCallback&&(this._readCallback=this._readCallback(t))})}}function K(){}function Y(e,t){const n=t.namedNode;e._namedNode=n,e._blankNode=t.blankNode,e._literal=t.literal,e._variable=t.variable,e._quad=t.quad,e.DEFAULTGRAPH=t.defaultGraph(),e.RDF_FIRST=n(S.rdf.first),e.RDF_REST=n(S.rdf.rest),e.RDF_NIL=n(S.rdf.nil),e.N3_FORALL=n(S.r.forAll),e.N3_FORSOME=n(S.r.forSome),e.ABBREVIATIONS={a:n(S.rdf.type),"=":n(S.owl.sameAs),">":n(S.log.implies)},e.QUANTIFIERS_GRAPH=n("urn:n3:quantifiers")}Y(Z.prototype,$);let J=class{constructor(e){this.prefixPipe=e}parseTriples(e){const t=new Z,n=[];return new Promise((r,i)=>{t.parse(e,(e,t,s)=>{t?n.push(t):r({triples:n,namespaces:s}),e&&i(e)})})}limitTriples(e,t){return e?e.length>t?e.slice(0,t):e:[]}abbreviateTriples(e,t,n){return n||(n="text/turtle"),e.map(e=>{let r=e.subject.nominalValue,i=e.predicate.nominalValue,s=e.object.nominalValue;return"text/turtle"===n&&(null!=this._abbreviate(r,t)&&(r=this._abbreviate(r,t)),null!=this._abbreviate(i,t)&&(i=this._abbreviate(i,t)),null!=this._abbreviate(s,t)&&(s=this._abbreviate(s,t))),{subject:r,predicate:i,object:s}})}appendNamespacesToQuery(e,t){if(!e||!t)return;const n=this._extractNamespacesFromTTL(t),r=this._extractPrefixesFromQuery(e),i=Object.keys(n);let s="";return i.forEach(e=>{-1!==r.indexOf(e)&&(s+=`PREFIX ${e} ${n[e]}\n`)}),""!==s&&(e=s+"\n"+e),e}doQuery(e,t,n,r){return r||(r="text/turtle"),this._createStore().then(e=>(this._store=e,this._loadTriplesInStore(e,n,r))).then(e=>this._executeQuery(this._store,t)).then(t=>{const i=t;return"select"===e?this._prepareSelectResponse(i).data:"construct"===e?this._getNamespaces(n).then(e=>this.abbreviateTriples(i.triples,e,r)):void 0})}getQuerytype(e){let t=[{queryType:"select",index:-1},{queryType:"construct",index:-1},{queryType:"ask",index:-1},{queryType:"count",index:-1},{queryType:"describe",index:-1},{queryType:"insert",index:-1},{queryType:"delete",index:-1}],n=!1,r=1/0;if(t=t.map(t=>(t.index=e.toLowerCase().indexOf(t.queryType),-1!==t.index&&(n=!0,t.index<r&&(r=t.index)),t)),!n)return null;const i=t.find(e=>e.index===r);if(!i)return null;const s=i.queryType;return"insert"===s||"delete"===s?"update":s}_abbreviate(e,t){let n=null;return-1!==e.indexOf("http")&&Object.entries(t).forEach(([t,r],i)=>{-1!==e.indexOf(r)&&(n=e.replace(r,t+":"))}),n}_createStore(){return new Promise((e,t)=>{rdfstore.create((n,r)=>{n&&t(n),e(r)})})}_executeQuery(e,t){return new Promise((n,r)=>{e.execute(t,(e,t)=>{e&&(console.error("_executeQuery# got ERROR",e),r(e)),n(t)})})}_extractNamespacesFromTTL(e){const t=e.replace(/\s/g," ").split(" ").filter(e=>""!==e),n=t.reduce((e,t,n)=>("@prefix"===t&&e.push(n),e),[]),r={};return n.forEach(e=>{r[t[e+1]]=t[e+2]}),r}_extractPrefixesFromQuery(e){const t=[],n=/[a-zA-Z]+:/g;let r;for(;null!==(r=n.exec(e));)r.index===n.lastIndex&&n.lastIndex++,r.forEach(e=>{-1===t.indexOf(e)&&t.push(e)});return t}_getNamespaces(e){const t=new Z;return new Promise((n,r)=>{t.parse(e,(e,t,i)=>{t||n(i),e&&r(e)})})}_loadTriplesInStore(e,t,n){return n||(n="text/turtle"),new Promise((r,i)=>{e.load(n,t,(e,t)=>{e&&(console.error("_loadTriplesInStore# got error",e),i(e)),r(t)})})}_mapKeys(e,t){const n=Object.keys(e).map(n=>({[t[n]||n]:e[n]}));return Object.assign({},...n)}_prepareSelectResponse(e){if(!e)return;if(null==e[0])return{status:400,data:"Query returned no results"};const t=Object.keys(e[0]),n=e,r={token:"type",type:"datatype",lang:"xml:lang"};for(const i in n)if(n.hasOwnProperty(i))for(const e in t)if(t.hasOwnProperty(e)&&(n[i][t[e]]=this._mapKeys(n[i][t[e]],r),n[i][t[e]].label="",n[i][t[e]].value)){n[i][t[e]].label=this.prefixPipe.transform(n[i][t[e]].value,d.short);const r="http://www.w3.org/2001/XMLSchema#integer";"literal"===n[i][t[e]].type&&n[i][t[e]].datatype===r&&(n[i][t[e]].label=+n[i][t[e]].value)}return{status:200,data:{head:{vars:t},body:{bindings:n}}}}};J.ctorParameters=()=>[{type:w}],J=(0,r.gn)([(0,i.GSi)()],J);var ee={value:()=>{}};function te(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new ne(r)}function ne(e){this._=e}function re(e,t){return e.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}function ie(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function se(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ee,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}ne.prototype=te.prototype={constructor:ne,on:function(e,t){var n,r=this._,i=re(e+"",r),s=-1,a=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=i[s]).type)r[n]=se(r[n],e.name,t);else if(null==t)for(n in r)r[n]=se(r[n],e.name,null);return this}for(;++s<a;)if((n=(e=i[s]).type)&&(n=ie(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ne(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(r=this._[e]).length;s<n;++s)r[s].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};const ae=te;function oe(){}function ue(e){return null==e?oe:function(){return this.querySelector(e)}}function le(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function ce(){return[]}function he(e){return null==e?ce:function(){return this.querySelectorAll(e)}}function pe(e){return function(){return this.matches(e)}}function fe(e){return function(t){return t.matches(e)}}var de=Array.prototype.find;function ge(){return this.firstElementChild}var _e=Array.prototype.filter;function ye(){return Array.from(this.children)}function me(e){return new Array(e.length)}function be(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function ve(e){return function(){return e}}function xe(e,t,n,r,i,s){for(var a,o=0,u=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new be(e,s[o]);for(;o<u;++o)(a=t[o])&&(i[o]=a)}function we(e,t,n,r,i,s,a){var o,u,l,c=new Map,h=t.length,p=s.length,f=new Array(h);for(o=0;o<h;++o)(u=t[o])&&(f[o]=l=a.call(u,u.__data__,o,t)+"",c.has(l)?i[o]=u:c.set(l,u));for(o=0;o<p;++o)l=a.call(e,s[o],o,s)+"",(u=c.get(l))?(r[o]=u,u.__data__=s[o],c.delete(l)):n[o]=new be(e,s[o]);for(o=0;o<h;++o)(u=t[o])&&c.get(f[o])===u&&(i[o]=u)}function ke(e){return e.__data__}function Re(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function qe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}be.prototype={constructor:be,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Se="http://www.w3.org/1999/xhtml";const Te={svg:"http://www.w3.org/2000/svg",xhtml:Se,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ie(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Te.hasOwnProperty(t)?{space:Te[t],local:e}:e}function Ne(e){return function(){this.removeAttribute(e)}}function Ee(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ce(e,t){return function(){this.setAttribute(e,t)}}function ze(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Fe(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Ae(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Pe(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function De(e){return function(){this.style.removeProperty(e)}}function Me(e,t,n){return function(){this.style.setProperty(e,t,n)}}function je(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Oe(e,t){return e.style.getPropertyValue(t)||Pe(e).getComputedStyle(e,null).getPropertyValue(t)}function Le(e){return function(){delete this[e]}}function $e(e,t){return function(){this[e]=t}}function Qe(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Ge(e){return e.trim().split(/^|\s+/)}function Be(e){return e.classList||new He(e)}function He(e){this._node=e,this._names=Ge(e.getAttribute("class")||"")}function Ve(e,t){for(var n=Be(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Ue(e,t){for(var n=Be(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Xe(e){return function(){Ve(this,e)}}function We(e){return function(){Ue(this,e)}}function Ze(e,t){return function(){(t.apply(this,arguments)?Ve:Ue)(this,e)}}function Ke(){this.textContent=""}function Ye(e){return function(){this.textContent=e}}function Je(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function et(){this.innerHTML=""}function tt(e){return function(){this.innerHTML=e}}function nt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function rt(){this.nextSibling&&this.parentNode.appendChild(this)}function it(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function st(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Se&&t.documentElement.namespaceURI===Se?t.createElement(e):t.createElementNS(n,e)}}function at(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ot(e){var t=Ie(e);return(t.local?at:st)(t)}function ut(){return null}function lt(){var e=this.parentNode;e&&e.removeChild(this)}function ct(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ht(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function pt(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function ft(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,s=t.length;r<s;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function dt(e,t,n){return function(){var r,i=this.__on,s=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var a=0,o=i.length;a<o;++a)if((r=i[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=t);this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function gt(e,t,n){var r=Pe(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function _t(e,t){return function(){return gt(this,e,t)}}function yt(e,t){return function(){return gt(this,e,t.apply(this,arguments))}}He.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var mt=[null];function bt(e,t){this._groups=e,this._parents=t}function vt(){return new bt([[document.documentElement]],mt)}bt.prototype=vt.prototype={constructor:bt,select:function(e){"function"!=typeof e&&(e=ue(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a,o=t[i],u=o.length,l=r[i]=new Array(u),c=0;c<u;++c)(s=o[c])&&(a=e.call(s,s.__data__,c,o))&&("__data__"in s&&(a.__data__=s.__data__),l[c]=a);return new bt(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return le(e.apply(this,arguments))}}(e):he(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var a,o=t[s],u=o.length,l=0;l<u;++l)(a=o[l])&&(r.push(e.call(a,a.__data__,l,o)),i.push(a));return new bt(r,i)},selectChild:function(e){return this.select(null==e?ge:function(e){return function(){return de.call(this.children,e)}}("function"==typeof e?e:fe(e)))},selectChildren:function(e){return this.selectAll(null==e?ye:function(e){return function(){return _e.call(this.children,e)}}("function"==typeof e?e:fe(e)))},filter:function(e){"function"!=typeof e&&(e=pe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a=t[i],o=a.length,u=r[i]=[],l=0;l<o;++l)(s=a[l])&&e.call(s,s.__data__,l,a)&&u.push(s);return new bt(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,ke);var n=t?we:xe,r=this._parents,i=this._groups;"function"!=typeof e&&(e=ve(e));for(var s=i.length,a=new Array(s),o=new Array(s),u=new Array(s),l=0;l<s;++l){var c=r[l],h=i[l],p=h.length,f=Re(e.call(c,c&&c.__data__,l,r)),d=f.length,g=o[l]=new Array(d),_=a[l]=new Array(d),y=u[l]=new Array(p);n(c,h,g,_,y,f,t);for(var m,b,v=0,x=0;v<d;++v)if(m=g[v]){for(v>=x&&(x=v+1);!(b=_[x])&&++x<d;);m._next=b||null}}return(a=new bt(a,r))._enter=o,a._exit=u,a},enter:function(){return new bt(this._enter||this._groups.map(me),this._parents)},exit:function(){return new bt(this._exit||this._groups.map(me),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,a=Math.min(i,s),o=new Array(i),u=0;u<a;++u)for(var l,c=n[u],h=r[u],p=c.length,f=o[u]=new Array(p),d=0;d<p;++d)(l=c[d]||h[d])&&(f[d]=l);for(;u<i;++u)o[u]=n[u];return new bt(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],s=i.length-1,a=i[s];--s>=0;)(r=i[s])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=qe);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var a,o=n[s],u=o.length,l=i[s]=new Array(u),c=0;c<u;++c)(a=o[c])&&(l[c]=a);l.sort(t)}return new bt(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var a=r[i];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,s=t[n],a=0,o=s.length;a<o;++a)(i=s[a])&&e.call(i,i.__data__,a,s);return this},attr:function(e,t){var n=Ie(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Ee:Ne:"function"==typeof t?n.local?Ae:Fe:n.local?ze:Ce)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?De:"function"==typeof t?je:Me)(e,t,null==n?"":n)):Oe(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Le:"function"==typeof t?Qe:$e)(e,t)):this.node()[e]},classed:function(e,t){var n=Ge(e+"");if(arguments.length<2){for(var r=Be(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Ze:t?Xe:We)(n,t))},text:function(e){return arguments.length?this.each(null==e?Ke:("function"==typeof e?Je:Ye)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?et:("function"==typeof e?nt:tt)(e)):this.node().innerHTML},raise:function(){return this.each(rt)},lower:function(){return this.each(it)},append:function(e){var t="function"==typeof e?e:ot(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:ot(e),r=null==t?ut:"function"==typeof t?t:ue(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(lt)},clone:function(e){return this.select(e?ht:ct)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,s=pt(e+""),a=s.length;if(!(arguments.length<2)){for(o=t?dt:ft,r=0;r<a;++r)this.each(o(s[r],t,n));return this}var o=this.node().__on;if(o)for(var u,l=0,c=o.length;l<c;++l)for(r=0,u=o[l];r<a;++r)if((i=s[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?yt:_t)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],s=0,a=i.length;s<a;++s)(r=i[s])&&(yield r)}};const xt=vt;function wt(e){return"string"==typeof e?new bt([[document.querySelector(e)]],[document.documentElement]):new bt([[e]],mt)}function kt(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Rt={passive:!1},qt={capture:!0,passive:!1};function St(e){e.stopImmediatePropagation()}function Tt(e){e.preventDefault(),e.stopImmediatePropagation()}function It(e){var t=e.document.documentElement,n=wt(e).on("dragstart.drag",Tt,qt);"onselectstart"in t?n.on("selectstart.drag",Tt,qt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Nt(e,t){var n=e.document.documentElement,r=wt(e).on("dragstart.drag",null);t&&(r.on("click.drag",Tt,qt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Et=e=>()=>e;function Ct(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:a,y:o,dx:u,dy:l,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:c}})}function zt(e){return!e.ctrlKey&&!e.button}function Ft(){return this.parentNode}function At(e,t){return null==t?{x:e.x,y:e.y}:t}function Pt(){return navigator.maxTouchPoints||"ontouchstart"in this}Ct.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Dt,Mt,jt=0,Ot=0,Lt=0,$t=0,Qt=0,Gt=0,Bt="object"==typeof performance&&performance.now?performance:Date,Ht="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Vt(){return Qt||(Ht(Ut),Qt=Bt.now()+Gt)}function Ut(){Qt=0}function Xt(){this._call=this._time=this._next=null}function Wt(e,t,n){var r=new Xt;return r.restart(e,t,n),r}function Zt(){Qt=($t=Bt.now())+Gt,jt=Ot=0;try{!function(){Vt(),++jt;for(var e,t=Dt;t;)(e=Qt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--jt}()}finally{jt=0,function(){var e,t,n=Dt,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Dt=t);Mt=e,Yt(r)}(),Qt=0}}function Kt(){var e=Bt.now(),t=e-$t;t>1e3&&(Gt-=t,$t=e)}function Yt(e){jt||(Ot&&(Ot=clearTimeout(Ot)),e-Qt>24?(e<1/0&&(Ot=setTimeout(Zt,e-Bt.now()-Gt)),Lt&&(Lt=clearInterval(Lt))):(Lt||($t=Bt.now(),Lt=setInterval(Kt,1e3)),jt=1,Ht(Zt)))}Xt.prototype=Wt.prototype={constructor:Xt,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Vt():+n)+(null==t?0:+t),this._next||Mt===this||(Mt?Mt._next=this:Dt=this,Mt=this),this._call=e,this._time=n,Yt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Yt())}};const Jt=4294967296;function en(e){return e.x}function tn(e){return e.y}var nn=Math.PI*(3-Math.sqrt(5));function rn(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,a=.6,o=new Map,u=Wt(h),l=ae("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%Jt)/Jt}();function h(){p(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function p(r){var u,l,c=e.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(s-n)*i,o.forEach(function(e){e(n)}),u=0;u<c;++u)null==(l=e[u]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),s=n*nn;t.x=i*Math.cos(s),t.y=i*Math.sin(s)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function d(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),f(),t={tick:p,restart:function(){return u.restart(h),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),o.forEach(d),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(s=+e,t):s},velocityDecay:function(e){return arguments.length?(a=1-e,t):1-a},randomSource:function(e){return arguments.length?(c=e,o.forEach(d),t):c},force:function(e,n){return arguments.length>1?(null==n?o.delete(e):o.set(e,d(n)),t):o.get(e)},find:function(t,n,r){var i,s,a,o,u,l=0,c=e.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(a=(i=t-(o=e[l]).x)*i+(s=n-o.y)*s)<r&&(u=o,r=a);return u},on:function(e,n){return arguments.length>1?(l.on(e,n),t):l.on(e)}}}function sn(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s,a,o,u,l,c,h,p,f=e._root,d={data:r},g=e._x0,_=e._y0,y=e._x1,m=e._y1;if(!f)return e._root=d,e;for(;f.length;)if((l=t>=(s=(g+y)/2))?g=s:y=s,(c=n>=(a=(_+m)/2))?_=a:m=a,i=f,!(f=f[h=c<<1|l]))return i[h]=d,e;if(o=+e._x.call(null,f.data),u=+e._y.call(null,f.data),t===o&&n===u)return d.next=f,i?i[h]=d:e._root=d,e;do{i=i?i[h]=new Array(4):e._root=new Array(4),(l=t>=(s=(g+y)/2))?g=s:y=s,(c=n>=(a=(_+m)/2))?_=a:m=a}while((h=c<<1|l)==(p=(u>=a)<<1|o>=s));return i[p]=f,i[h]=d,e}function an(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function on(e){return e[0]}function un(e){return e[1]}function ln(e,t,n){var r=new cn(null==t?on:t,null==n?un:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function cn(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function hn(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var pn=ln.prototype=cn.prototype;function fn(e){return function(){return e}}function dn(e){return 1e-6*(e()-.5)}function gn(e){return e.x+e.vx}function _n(e){return e.y+e.vy}function yn(e){return e.index}function mn(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}pn.copy=function(){var e,t,n=new cn(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=hn(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=hn(t));return n},pn.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return sn(this.cover(t,n),t,n,e)},pn.addAll=function(e){var t,n,r,i,s=e.length,a=new Array(s),o=new Array(s),u=1/0,l=1/0,c=-1/0,h=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(a[n]=r,o[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>h&&(h=i));if(u>c||l>h)return this;for(this.cover(u,l).cover(c,h),n=0;n<s;++n)sn(this,a[n],o[n],e[n]);return this},pn.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var a,o,u=i-n||1,l=this._root;n>e||e>=i||r>t||t>=s;)switch(o=(t<r)<<1|e<n,(a=new Array(4))[o]=l,l=a,u*=2,o){case 0:i=n+u,s=r+u;break;case 1:n=i-u,s=r+u;break;case 2:i=n+u,r=s-u;break;case 3:n=i-u,r=s-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},pn.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},pn.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},pn.find=function(e,t,n){var r,i,s,a,o,u,l,c=this._x0,h=this._y0,p=this._x1,f=this._y1,d=[],g=this._root;for(g&&d.push(new an(g,c,h,p,f)),null==n?n=1/0:(c=e-n,h=t-n,p=e+n,f=t+n,n*=n);u=d.pop();)if(!(!(g=u.node)||(i=u.x0)>p||(s=u.y0)>f||(a=u.x1)<c||(o=u.y1)<h))if(g.length){var _=(i+a)/2,y=(s+o)/2;d.push(new an(g[3],_,y,a,o),new an(g[2],i,y,_,o),new an(g[1],_,s,a,y),new an(g[0],i,s,_,y)),(l=(t>=y)<<1|e>=_)&&(u=d[d.length-1],d[d.length-1]=d[d.length-1-l],d[d.length-1-l]=u)}else{var m=e-+this._x.call(null,g.data),b=t-+this._y.call(null,g.data),v=m*m+b*b;if(v<n){var x=Math.sqrt(n=v);c=e-x,h=t-x,p=e+x,f=t+x,r=g.data}}return r},pn.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(a=+this._y.call(null,e)))return this;var t,n,r,i,s,a,o,u,l,c,h,p,f=this._root,d=this._x0,g=this._y0,_=this._x1,y=this._y1;if(!f)return this;if(f.length)for(;;){if((l=s>=(o=(d+_)/2))?d=o:_=o,(c=a>=(u=(g+y)/2))?g=u:y=u,t=f,!(f=f[h=c<<1|l]))return this;if(!f.length)break;(t[h+1&3]||t[h+2&3]||t[h+3&3])&&(n=t,p=h)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):t?(i?t[h]=i:delete t[h],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[p]=f:this._root=f),this):(this._root=i,this)},pn.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},pn.root=function(){return this._root},pn.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},pn.visit=function(e){var t,n,r,i,s,a,o=[],u=this._root;for(u&&o.push(new an(u,this._x0,this._y0,this._x1,this._y1));t=o.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,s=t.x1,a=t.y1)&&u.length){var l=(r+s)/2,c=(i+a)/2;(n=u[3])&&o.push(new an(n,l,c,s,a)),(n=u[2])&&o.push(new an(n,r,c,l,a)),(n=u[1])&&o.push(new an(n,l,i,s,c)),(n=u[0])&&o.push(new an(n,r,i,l,c))}return this},pn.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new an(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var s,a=t.x0,o=t.y0,u=t.x1,l=t.y1,c=(a+u)/2,h=(o+l)/2;(s=i[0])&&n.push(new an(s,a,o,c,h)),(s=i[1])&&n.push(new an(s,c,o,u,h)),(s=i[2])&&n.push(new an(s,a,h,c,l)),(s=i[3])&&n.push(new an(s,c,h,u,l))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},pn.x=function(e){return arguments.length?(this._x=e,this):this._x},pn.y=function(e){return arguments.length?(this._y=e,this):this._y};function bn(e){return((e=Math.exp(e))+1/e)/2}const vn=function e(t,n,r){function i(e,i){var s,a,o=e[0],u=e[1],l=e[2],c=i[0],h=i[1],p=i[2],f=c-o,d=h-u,g=f*f+d*d;if(g<1e-12)a=Math.log(p/l)/t,s=function(e){return[o+e*f,u+e*d,l*Math.exp(t*e*a)]};else{var _=Math.sqrt(g),y=(p*p-l*l+r*g)/(2*l*n*_),m=(p*p-l*l-r*g)/(2*p*n*_),b=Math.log(Math.sqrt(y*y+1)-y),v=Math.log(Math.sqrt(m*m+1)-m);a=(v-b)/t,s=function(e){var r=e*a,i=bn(b),s=l/(n*_)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[o+s*f,u+s*d,l*i/bn(t*r+b)]}}return s.duration=1e3*a*t/Math.SQRT2,s}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function xn(e,t,n){var r=new Xt;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}var wn=ae("start","end","cancel","interrupt"),kn=[];function Rn(e,t,n,r,i,s){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function s(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}function a(s){var l,c,h,p;if(1!==n.state)return u();for(l in i)if((p=i[l]).name===n.name){if(3===p.state)return xn(a);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete i[l]):+l<t&&(p.state=6,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete i[l])}if(xn(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(s))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(p=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++c]=p);r.length=c+1}}function o(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(u),n.state=5,1),s=-1,a=r.length;++s<a;)r[s].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=Wt(s,0,n.time)}(e,n,{name:t,index:r,group:i,on:wn,tween:kn,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function qn(e,t){var n=Tn(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Sn(e,t){var n=Tn(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Tn(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function In(e,t){var n,r,i,s=e.__transition,a=!0;if(s){for(i in t=null==t?null:t+"",s)(n=s[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete s[i]):a=!1;a&&delete e.__transition}}function Nn(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var En,Cn=180/Math.PI,zn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Fn(e,t,n,r,i,s){var a,o,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,u/=o),e*r<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Cn,skewX:Math.atan(u)*Cn,scaleX:a,scaleY:o}}function An(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(s,a){var o=[],u=[];return s=e(s),a=e(a),function(e,r,i,s,a,o){if(e!==i||r!==s){var u=a.push("translate(",null,t,null,n);o.push({i:u-4,x:Nn(e,i)},{i:u-2,x:Nn(r,s)})}else(i||s)&&a.push("translate("+i+t+s+n)}(s.translateX,s.translateY,a.translateX,a.translateY,o,u),function(e,t,n,s){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Nn(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(s.rotate,a.rotate,o,u),function(e,t,n,s){e!==t?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Nn(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(s.skewX,a.skewX,o,u),function(e,t,n,r,s,a){if(e!==n||t!==r){var o=s.push(i(s)+"scale(",null,",",null,")");a.push({i:o-4,x:Nn(e,n)},{i:o-2,x:Nn(t,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,u),s=a=null,function(e){for(var t,n=-1,r=u.length;++n<r;)o[(t=u[n]).i]=t.x(e);return o.join("")}}}var Pn=An(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?zn:Fn(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),Dn=An(function(e){return null==e?zn:(En||(En=document.createElementNS("http://www.w3.org/2000/svg","g")),En.setAttribute("transform",e),(e=En.transform.baseVal.consolidate())?Fn((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):zn)},", ",")",")");function Mn(e,t){var n,r;return function(){var i=Sn(this,e),s=i.tween;if(s!==n)for(var a=0,o=(r=n=s).length;a<o;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}i.tween=r}}function jn(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=Sn(this,e),a=s.tween;if(a!==r){i=(r=a).slice();for(var o={name:t,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=o;break}u===l&&i.push(o)}s.tween=i}}function On(e,t,n){var r=e._id;return e.each(function(){var e=Sn(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Tn(e,r).value[t]}}function Ln(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function $n(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Qn(){}var Gn=.7,Bn=1/Gn,Hn="\\s*([+-]?\\d+)\\s*",Vn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Un="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Xn=/^#([0-9a-f]{3,8})$/,Wn=new RegExp("^rgb\\("+[Hn,Hn,Hn]+"\\)$"),Zn=new RegExp("^rgb\\("+[Un,Un,Un]+"\\)$"),Kn=new RegExp("^rgba\\("+[Hn,Hn,Hn,Vn]+"\\)$"),Yn=new RegExp("^rgba\\("+[Un,Un,Un,Vn]+"\\)$"),Jn=new RegExp("^hsl\\("+[Vn,Un,Un]+"\\)$"),er=new RegExp("^hsla\\("+[Vn,Un,Un,Vn]+"\\)$"),tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function nr(){return this.rgb().formatHex()}function rr(){return this.rgb().formatRgb()}function ir(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Xn.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?sr(t):3===n?new lr(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?ar(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?ar(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Wn.exec(e))?new lr(t[1],t[2],t[3],1):(t=Zn.exec(e))?new lr(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Kn.exec(e))?ar(t[1],t[2],t[3],t[4]):(t=Yn.exec(e))?ar(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Jn.exec(e))?fr(t[1],t[2]/100,t[3]/100,1):(t=er.exec(e))?fr(t[1],t[2]/100,t[3]/100,t[4]):tr.hasOwnProperty(e)?sr(tr[e]):"transparent"===e?new lr(NaN,NaN,NaN,0):null}function sr(e){return new lr(e>>16&255,e>>8&255,255&e,1)}function ar(e,t,n,r){return r<=0&&(e=t=n=NaN),new lr(e,t,n,r)}function or(e){return e instanceof Qn||(e=ir(e)),e?new lr((e=e.rgb()).r,e.g,e.b,e.opacity):new lr}function ur(e,t,n,r){return 1===arguments.length?or(e):new lr(e,t,n,null==r?1:r)}function lr(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function cr(){return"#"+pr(this.r)+pr(this.g)+pr(this.b)}function hr(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function pr(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function fr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new gr(e,t,n,r)}function dr(e){if(e instanceof gr)return new gr(e.h,e.s,e.l,e.opacity);if(e instanceof Qn||(e=ir(e)),!e)return new gr;if(e instanceof gr)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),a=NaN,o=s-i,u=(s+i)/2;return o?(a=t===s?(n-r)/o+6*(n<r):n===s?(r-t)/o+2:(t-n)/o+4,o/=u<.5?s+i:2-s-i,a*=60):o=u>0&&u<1?0:a,new gr(a,o,u,e.opacity)}function gr(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function _r(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function yr(e,t,n,r,i){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*n+(1+3*e+3*s-3*a)*r+a*i)/6}Ln(Qn,ir,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:nr,formatHex:nr,formatHsl:function(){return dr(this).formatHsl()},formatRgb:rr,toString:rr}),Ln(lr,ur,$n(Qn,{brighter:function(e){return e=null==e?Bn:Math.pow(Bn,e),new lr(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Gn:Math.pow(Gn,e),new lr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cr,formatHex:cr,formatRgb:hr,toString:hr})),Ln(gr,function(e,t,n,r){return 1===arguments.length?dr(e):new gr(e,t,n,null==r?1:r)},$n(Qn,{brighter:function(e){return e=null==e?Bn:Math.pow(Bn,e),new gr(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Gn:Math.pow(Gn,e),new gr(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new lr(_r(e>=240?e-240:e+120,i,r),_r(e,i,r),_r(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const mr=e=>()=>e;function br(e,t){return function(n){return e+n*t}}function vr(e){return 1==(e=+e)?xr:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):mr(isNaN(t)?n:t)}}function xr(e,t){var n=t-e;return n?br(e,n):mr(isNaN(e)?t:e)}const wr=function e(t){var n=vr(t);function r(e,t){var r=n((e=ur(e)).r,(t=ur(t)).r),i=n(e.g,t.g),s=n(e.b,t.b),a=xr(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=s(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function kr(e){return function(t){var n,r,i=t.length,s=new Array(i),a=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=ur(t[n]),s[n]=r.r||0,a[n]=r.g||0,o[n]=r.b||0;return s=e(s),a=e(a),o=e(o),r.opacity=1,function(e){return r.r=s(e),r.g=a(e),r.b=o(e),r+""}}}kr(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],a=r>0?e[r-1]:2*i-s,o=r<t-1?e[r+2]:2*s-i;return yr((n-r/t)*t,a,i,s,o)}}),kr(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],a=e[(r+1)%t],o=e[(r+2)%t];return yr((n-r/t)*t,i,s,a,o)}});var Rr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qr=new RegExp(Rr.source,"g");function Sr(e,t){var n,r,i,s=Rr.lastIndex=qr.lastIndex=0,a=-1,o=[],u=[];for(e+="",t+="";(n=Rr.exec(e))&&(r=qr.exec(t));)(i=r.index)>s&&(i=t.slice(s,i),o[a]?o[a]+=i:o[++a]=i),(n=n[0])===(r=r[0])?o[a]?o[a]+=r:o[++a]=r:(o[++a]=null,u.push({i:a,x:Nn(n,r)})),s=qr.lastIndex;return s<t.length&&(i=t.slice(s),o[a]?o[a]+=i:o[++a]=i),o.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)o[(n=u[r]).i]=n.x(e);return o.join("")})}function Tr(e,t){var n;return("number"==typeof t?Nn:t instanceof ir?wr:(n=ir(t))?(t=n,wr):Sr)(e,t)}function Ir(e){return function(){this.removeAttribute(e)}}function Nr(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Er(e,t,n){var r,i,s=n+"";return function(){var a=this.getAttribute(e);return a===s?null:a===r?i:i=t(r=a,n)}}function Cr(e,t,n){var r,i,s=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===s?null:a===r?i:i=t(r=a,n)}}function zr(e,t,n){var r,i,s;return function(){var a,o,u=n(this);if(null!=u)return(a=this.getAttribute(e))===(o=u+"")?null:a===r&&o===i?s:(i=o,s=t(r=a,u));this.removeAttribute(e)}}function Fr(e,t,n){var r,i,s;return function(){var a,o,u=n(this);if(null!=u)return(a=this.getAttributeNS(e.space,e.local))===(o=u+"")?null:a===r&&o===i?s:(i=o,s=t(r=a,u));this.removeAttributeNS(e.space,e.local)}}function Ar(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Pr(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Dr(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&Pr(e,i)),n}return i._value=t,i}function Mr(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&Ar(e,i)),n}return i._value=t,i}function jr(e,t){return function(){qn(this,e).delay=+t.apply(this,arguments)}}function Or(e,t){return t=+t,function(){qn(this,e).delay=t}}function Lr(e,t){return function(){Sn(this,e).duration=+t.apply(this,arguments)}}function $r(e,t){return t=+t,function(){Sn(this,e).duration=t}}function Qr(e,t){if("function"!=typeof t)throw new Error;return function(){Sn(this,e).ease=t}}function Gr(e,t,n){var r,i,s=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?qn:Sn;return function(){var a=s(this,e),o=a.on;o!==r&&(i=(r=o).copy()).on(t,n),a.on=i}}var Br=xt.prototype.constructor;function Hr(e){return function(){this.style.removeProperty(e)}}function Vr(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Ur(e,t,n){var r,i;function s(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&Vr(e,s,n)),r}return s._value=t,s}function Xr(e){return function(t){this.textContent=e.call(this,t)}}function Wr(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Xr(r)),t}return r._value=e,r}var Zr=0;function Kr(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Yr(){return++Zr}var Jr=xt.prototype;Kr.prototype=(function(e){return xt().transition(e)}).prototype={constructor:Kr,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=ue(e));for(var r=this._groups,i=r.length,s=new Array(i),a=0;a<i;++a)for(var o,u,l=r[a],c=l.length,h=s[a]=new Array(c),p=0;p<c;++p)(o=l[p])&&(u=e.call(o,o.__data__,p,l))&&("__data__"in o&&(u.__data__=o.__data__),h[p]=u,Rn(h[p],t,n,p,h,Tn(o,n)));return new Kr(s,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=he(e));for(var r=this._groups,i=r.length,s=[],a=[],o=0;o<i;++o)for(var u,l=r[o],c=l.length,h=0;h<c;++h)if(u=l[h]){for(var p,f=e.call(u,u.__data__,h,l),d=Tn(u,n),g=0,_=f.length;g<_;++g)(p=f[g])&&Rn(p,t,n,g,f,d);s.push(f),a.push(u)}return new Kr(s,a,t,n)},selectChild:Jr.selectChild,selectChildren:Jr.selectChildren,filter:function(e){"function"!=typeof e&&(e=pe(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s,a=t[i],o=a.length,u=r[i]=[],l=0;l<o;++l)(s=a[l])&&e.call(s,s.__data__,l,a)&&u.push(s);return new Kr(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),a=new Array(r),o=0;o<s;++o)for(var u,l=t[o],c=n[o],h=l.length,p=a[o]=new Array(h),f=0;f<h;++f)(u=l[f]||c[f])&&(p[f]=u);for(;o<r;++o)a[o]=t[o];return new Kr(a,this._parents,this._name,this._id)},selection:function(){return new Br(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=Yr(),r=this._groups,i=r.length,s=0;s<i;++s)for(var a,o=r[s],u=o.length,l=0;l<u;++l)if(a=o[l]){var c=Tn(a,t);Rn(a,e,n,l,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Kr(r,this._parents,e,n)},call:Jr.call,nodes:Jr.nodes,node:Jr.node,size:Jr.size,empty:Jr.empty,each:Jr.each,on:function(e,t){var n=this._id;return arguments.length<2?Tn(this.node(),n).on.on(e):this.each(Gr(n,e,t))},attr:function(e,t){var n=Ie(e),r="transform"===n?Dn:Tr;return this.attrTween(e,"function"==typeof t?(n.local?Fr:zr)(n,r,On(this,"attr."+e,t)):null==t?(n.local?Nr:Ir)(n):(n.local?Cr:Er)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Ie(e);return this.tween(n,(r.local?Dr:Mr)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?Pn:Tr;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var s=Oe(this,e),a=(this.style.removeProperty(e),Oe(this,e));return s===a?null:s===n&&a===r?i:i=t(n=s,r=a)}}(e,r)).on("end.style."+e,Hr(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,s;return function(){var a=Oe(this,e),o=n(this),u=o+"";return null==o&&(this.style.removeProperty(e),u=o=Oe(this,e)),a===u?null:a===r&&u===i?s:(i=u,s=t(r=a,o))}}(e,r,On(this,"style."+e,t))).each(function(e,t){var n,r,i,s,a="style."+t,o="end."+a;return function(){var u=Sn(this,e),l=u.on,c=null==u.value[a]?s||(s=Hr(t)):void 0;l===n&&i===c||(r=(n=l).copy()).on(o,i=c),u.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,s=n+"";return function(){var a=Oe(this,e);return a===s?null:a===r?i:i=t(r=a,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,Ur(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(On(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,Wr(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Tn(this.node(),n).tween,s=0,a=i.length;s<a;++s)if((r=i[s]).name===e)return r.value;return null}return this.each((null==t?Mn:jn)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?jr:Or)(t,e)):Tn(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Lr:$r)(t,e)):Tn(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(Qr(t,e)):Tn(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Sn(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,a){var o={value:a},u={value:function(){0==--i&&s()}};n.each(function(){var n=Sn(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(o),t._.interrupt.push(o),t._.end.push(u)),n.on=t}),0===i&&s()})},[Symbol.iterator]:Jr[Symbol.iterator]};var ei={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function ti(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}xt.prototype.interrupt=function(e){return this.each(function(){In(this,e)})},xt.prototype.transition=function(e){var t,n;e instanceof Kr?(t=e._id,e=e._name):(t=Yr(),(n=ei).time=Vt(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var a,o=r[s],u=o.length,l=0;l<u;++l)(a=o[l])&&Rn(a,e,t,l,o,n||ti(a,t));return new Kr(r,this._parents,e,t)};const ni=e=>()=>e;function ri(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function ii(e,t,n){this.k=e,this.x=t,this.y=n}ii.prototype={constructor:ii,scale:function(e){return 1===e?this:new ii(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new ii(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var si=new ii(1,0,0);function ai(e){e.stopImmediatePropagation()}function oi(e){e.preventDefault(),e.stopImmediatePropagation()}function ui(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function li(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function ci(){return this.__zoom||si}function hi(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function pi(){return navigator.maxTouchPoints||"ontouchstart"in this}function fi(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a))}(function(e){for(;!e.__zoom;)if(!(e=e.parentNode))return si;return e.__zoom}).prototype=ii.prototype;const di=50,gi=1,_i=-3;let yi=class{constructor(e,t){this.graphVisualizerService=e,this.prefixPipe=t,this.clickedNodeRequest=new i.vpe,this.faCompressArrowsAlt=c.udn,this.limitValues=[5,10,25,50,100,250,500,1e3],this.limit=50,this.sliderConfig={initial:1,min:.1,max:3,step:.01,value:1},this._resize$=new o.xQ,this._destroy$=new o.xQ}onResize(){this._graphContainer&&this.queryResultTriples&&(this._divWidth=this._getContainerWidth(this._graphContainer),this._divHeight=this._getContainerHeight(this._graphContainer),this._resize$.next(!0))}ngOnInit(){this._resize$.pipe((0,u.b)(150),(0,l.R)(this._destroy$)).subscribe(e=>{this._redraw()}),this._redraw()}ngOnChanges(e){e.queryResultTriples&&e.queryResultTriples.currentValue&&!e.queryResultTriples.isFirstChange()&&(this.queryResultTriples=e.queryResultTriples.currentValue,this._redraw())}onLimitValueChange(e){this.limit=e,this._redraw()}onReCenter(){this._svg&&this._divWidth&&this._divHeight&&(this.onZoomChange(this.sliderConfig.initial),this._zoomBehaviour.translateTo(this._svg,this._divWidth/2,this._divHeight/2))}onZoomChange(e){this.sliderConfig.value=e,this._reScaleZoom()}log(e,t){const n=t?JSON.parse(JSON.stringify(t)):t;console.info(e,n)}ngOnDestroy(){this._destroy$.next(!0),this._destroy$.unsubscribe()}_redraw(){this.queryResultTriples&&(this._cleanSVG(),this._createSVG(),this._attachData(),this._reScaleZoom())}_cleanSVG(){(function(e){return"string"==typeof e?new bt([document.querySelectorAll(e)],[document.documentElement]):new bt([le(e)],mt)})("svg.force-graph > *").remove()}_createSVG(){this._graphContainer&&(this._divWidth=this._divWidth?this._divWidth:this._getContainerWidth(this._graphContainer)?this._getContainerWidth(this._graphContainer):400,this._divHeight=this.height?this.height:this._getContainerHeight(this._graphContainer)?this._getContainerHeight(this._graphContainer):500,this._divHeight=this._divHeight-20,this._svg||(this._svg=wt(this._graphContainer.nativeElement).append("svg").attr("class","force-graph")),this._svg.attr("width",this._divWidth).attr("height",this._divHeight),this._zoomGroup=this._svg.append("g").attr("class","zoom-container"))}_attachData(){const e=this.graphVisualizerService.limitTriples(this.queryResultTriples,this.limit);"string"==typeof e?this.graphVisualizerService.parseTriples(e).then(e=>{const t=this.graphVisualizerService.abbreviateTriples(e.triples,e.namespaces);this._simulationData=this._triplesToD3GraphData(t),this._setupForceSimulation(),this._updateSVG()}):(this._simulationData=this._triplesToD3GraphData(e),this._setupForceSimulation(),this._updateSVG())}_setupForceSimulation(){this._forceSimulation=rn();const e=function(){var e,t,n,r,i,s=fn(-30),a=1,o=1/0,u=.81;function l(n){var i,s=e.length,a=ln(e,en,tn).visitAfter(h);for(r=n,i=0;i<s;++i)t=e[i],a.visit(p)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+s(n,t,e)}}function h(e){var t,n,r,s,a,o=0,u=0;if(e.length){for(r=s=a=0;a<4;++a)(t=e[a])&&(n=Math.abs(t.value))&&(o+=t.value,u+=n,r+=n*t.x,s+=n*t.y);e.x=r/u,e.y=s/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{o+=i[t.data.index]}while(t=t.next)}e.value=o}function p(e,s,l,c){if(!e.value)return!0;var h=e.x-t.x,p=e.y-t.y,f=c-s,d=h*h+p*p;if(f*f/u<d)return d<o&&(0===h&&(d+=(h=dn(n))*h),0===p&&(d+=(p=dn(n))*p),d<a&&(d=Math.sqrt(a*d)),t.vx+=h*e.value*r/d,t.vy+=p*e.value*r/d),!0;if(!(e.length||d>=o)){(e.data!==t||e.next)&&(0===h&&(d+=(h=dn(n))*h),0===p&&(d+=(p=dn(n))*p),d<a&&(d=Math.sqrt(a*d)));do{e.data!==t&&(f=i[e.data.index]*r/d,t.vx+=h*f,t.vy+=p*f)}while(e=e.next)}}return l.initialize=function(t,r){e=t,n=r,c()},l.strength=function(e){return arguments.length?(s="function"==typeof e?e:fn(+e),c(),l):s},l.distanceMin=function(e){return arguments.length?(a=e*e,l):Math.sqrt(a)},l.distanceMax=function(e){return arguments.length?(o=e*e,l):Math.sqrt(o)},l.theta=function(e){return arguments.length?(u=e*e,l):Math.sqrt(u)},l}().strength(e=>this._nodeRadius(e)*_i),t=function(e,t){var n,r=1;function i(){var i,s,a=n.length,o=0,u=0;for(i=0;i<a;++i)o+=(s=n[i]).x,u+=s.y;for(o=(o/a-e)*r,u=(u/a-t)*r,i=0;i<a;++i)(s=n[i]).x-=o,s.y-=u}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i}(this._divWidth/2,this._divHeight/2),n=function(e){var t,n,r,i=1,s=1;function a(){for(var e,a,u,l,c,h,p,f=t.length,d=0;d<s;++d)for(a=ln(t,gn,_n).visitAfter(o),e=0;e<f;++e)u=t[e],h=n[u.index],p=h*h,l=u.x+u.vx,c=u.y+u.vy,a.visit(g);function g(e,t,n,s,a){var o=e.data,f=e.r,d=h+f;if(!o)return t>l+d||s<l-d||n>c+d||a<c-d;if(o.index>u.index){var g=l-o.x-o.vx,_=c-o.y-o.vy,y=g*g+_*_;y<d*d&&(0===g&&(y+=(g=dn(r))*g),0===_&&(y+=(_=dn(r))*_),y=(d-(y=Math.sqrt(y)))/y*i,u.vx+=(g*=y)*(d=(f*=f)/(p+f)),u.vy+=(_*=y)*d,o.vx-=g*(d=1-d),o.vy-=_*d)}}}function o(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var r,i,s=t.length;for(n=new Array(s),r=0;r<s;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=fn(null==e?1:+e)),a.initialize=function(e,n){t=e,r=n,u()},a.iterations=function(e){return arguments.length?(s=+e,a):s},a.strength=function(e){return arguments.length?(i=+e,a):i},a.radius=function(t){return arguments.length?(e="function"==typeof t?t:fn(+t),u(),a):e},a}().strength(gi).radius(e=>e.r+5).iterations(2),r=function(e){var t,n,r,i,s,a,o=yn,u=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},l=fn(30),c=1;function h(r){for(var i=0,o=e.length;i<c;++i)for(var u,l,h,p,f,d,g,_=0;_<o;++_)l=(u=e[_]).source,p=(h=u.target).x+h.vx-l.x-l.vx||dn(a),f=h.y+h.vy-l.y-l.vy||dn(a),p*=d=((d=Math.sqrt(p*p+f*f))-n[_])/d*r*t[_],f*=d,h.vx-=p*(g=s[_]),h.vy-=f*g,l.vx+=p*(g=1-g),l.vy+=f*g}function p(){if(r){var a,u,l=r.length,c=e.length,h=new Map(r.map((e,t)=>[o(e,t,r),e]));for(a=0,i=new Array(l);a<c;++a)(u=e[a]).index=a,"object"!=typeof u.source&&(u.source=mn(h,u.source)),"object"!=typeof u.target&&(u.target=mn(h,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(a=0,s=new Array(c);a<c;++a)u=e[a],s[a]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);t=new Array(c),f(),n=new Array(c),d()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+u(e[n],n,e)}function d(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+l(e[t],t,e)}return null==e&&(e=[]),h.initialize=function(e,t){r=e,a=t,p()},h.links=function(t){return arguments.length?(e=t,p(),h):e},h.id=function(e){return arguments.length?(o=e,h):o},h.iterations=function(e){return arguments.length?(c=+e,h):c},h.strength=function(e){return arguments.length?(u="function"==typeof e?e:fn(+e),f(),h):u},h.distance=function(e){return arguments.length?(l="function"==typeof e?e:fn(+e),d(),h):l},h}().links(this._simulationData.links).id(e=>e.predicate).distance(di);this._forceSimulation.force("charge_force",e).force("center_force",t).force("collide_force",n),this._forceSimulation.nodes(this._simulationData.nodes),this._forceSimulation.force("links",r),this._forceSimulation.alpha(1).restart()}_updateSVG(){if(!this._svg)return;this._zoomGroup.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",30).attr("refY",-.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:polyline").attr("points","0,-5 10,0 0,5");const e=this._zoomGroup.append("g").attr("class","links").selectAll(".link").data(this._simulationData.nodeTriples).enter().append("path").attr("marker-end","url(#end)").attr("class","link"),t=this._zoomGroup.append("g").attr("class","link-texts").selectAll(".link-text").data(this._simulationData.nodeTriples).enter().append("text").attr("class","link-text").text(e=>e.nodePredicate.label),n=this._zoomGroup.append("g").attr("class","node-texts").selectAll(".node-text").data(this._filterNodesByType(this._simulationData.nodes,f.node)).enter().append("text").attr("class","node-text").text(e=>e.label),r=this._zoomGroup.append("g").attr("class","nodes").selectAll(".node").data(this._filterNodesByType(this._simulationData.nodes,f.node)).enter().append("circle").attr("class",e=>e.owlClass?"class":-1!==e.label.indexOf("_:")?"blank":e.instance||-1!==e.label.indexOf("inst:")?"instance":"node").attr("id",e=>e.label).attr("r",e=>-1!==e.label.indexOf("_:")?8:e.instance||-1!==e.label.indexOf("inst:")?11:e.owlClass||-1!==e.label.indexOf("inst:")?10:9).on("click",(e,t)=>{this._clickedOnNode(e,t)});this._forceSimulation.on("tick",()=>{this._updateNodePositions(r),this._updateNodeTextPositions(n),this._updateLinkPositions(e),this._updateLinkTextPositions(t)}),this._dragHandler(r,this._forceSimulation),this._zoomHandler(this._zoomGroup,this._svg)}_reScaleZoom(){this._svg&&this.sliderConfig.value&&this._zoomBehaviour.scaleTo(this._svg,this.sliderConfig.value)}_checkForRdfType(e){return"a"===e.label||"rdf:type"===e.label||e.label===this.prefixPipe.transform("rdf:type",d.long)}_clickedOnNode(e,t){e.defaultPrevented||this.clickedNodeRequest.emit(t)}_dragHandler(e,t){const n=function(){var e,t,n,r,i=zt,s=Ft,a=At,o=Pt,u={},l=ae("start","drag","end"),c=0,h=0;function p(e){e.on("mousedown.drag",f).filter(o).on("touchstart.drag",_).on("touchmove.drag",y,Rt).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(a,o){if(!r&&i.call(this,a,o)){var u=b(this,s.call(this,a,o),a,o,"mouse");u&&(wt(a.view).on("mousemove.drag",d,qt).on("mouseup.drag",g,qt),It(a.view),St(a),n=!1,e=a.clientX,t=a.clientY,u("start",a))}}function d(r){if(Tt(r),!n){var i=r.clientX-e,s=r.clientY-t;n=i*i+s*s>h}u.mouse("drag",r)}function g(e){wt(e.view).on("mousemove.drag mouseup.drag",null),Nt(e.view,n),Tt(e),u.mouse("end",e)}function _(e,t){if(i.call(this,e,t)){var n,r,a=e.changedTouches,o=s.call(this,e,t),u=a.length;for(n=0;n<u;++n)(r=b(this,o,e,t,a[n].identifier,a[n]))&&(St(e),r("start",e,a[n]))}}function y(e){var t,n,r=e.changedTouches,i=r.length;for(t=0;t<i;++t)(n=u[r[t].identifier])&&(Tt(e),n("drag",e,r[t]))}function m(e){var t,n,i=e.changedTouches,s=i.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),t=0;t<s;++t)(n=u[i[t].identifier])&&(St(e),n("end",e,i[t]))}function b(e,t,n,r,i,s){var o,h,f,d=l.copy(),g=kt(s||n,t);if(null!=(f=a.call(e,new Ct("beforestart",{sourceEvent:n,target:p,identifier:i,active:c,x:g[0],y:g[1],dx:0,dy:0,dispatch:d}),r)))return o=f.x-g[0]||0,h=f.y-g[1]||0,function n(s,a,l){var _,y=g;switch(s){case"start":u[i]=n,_=c++;break;case"end":delete u[i],--c;case"drag":g=kt(l||a,t),_=c}d.call(s,e,new Ct(s,{sourceEvent:a,subject:f,target:p,identifier:i,active:_,x:g[0]+o,y:g[1]+h,dx:g[0]-y[0],dy:g[1]-y[1],dispatch:d}),r)}}return p.filter=function(e){return arguments.length?(i="function"==typeof e?e:Et(!!e),p):i},p.container=function(e){return arguments.length?(s="function"==typeof e?e:Et(e),p):s},p.subject=function(e){return arguments.length?(a="function"==typeof e?e:Et(e),p):a},p.touchable=function(e){return arguments.length?(o="function"==typeof e?e:Et(!!e),p):o},p.on=function(){var e=l.on.apply(l,arguments);return e===l?p:e},p.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,p):Math.sqrt(h)},p}().on("start",(e,n)=>{e.sourceEvent.stopPropagation(),e.active||t.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y}).on("drag",(e,t)=>{t.fx=e.x,t.fy=e.y}).on("end",(e,n)=>{e.active||t.alphaTarget(0),n.fx=null,n.fy=null});e.call(n)}_zoomHandler(e,t){this._zoomBehaviour=function(){var e,t,n,r=ui,i=li,s=fi,a=hi,o=pi,u=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],c=250,h=vn,p=ae("start","zoom","end"),f=500,d=0,g=10;function _(e){e.property("__zoom",ci).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",q).filter(o).on("touchstart.zoom",S).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",I).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(e,t){return(t=Math.max(u[0],Math.min(u[1],t)))===e.k?e:new ii(t,e.x,e.y)}function m(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new ii(e.k,r,i)}function b(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function v(e,t,n,r){e.on("start.zoom",function(){x(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(r).end()}).tween("zoom",function(){var e=this,s=arguments,a=x(e,s).event(r),o=i.apply(e,s),u=null==n?b(o):"function"==typeof n?n.apply(e,s):n,l=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),c=e.__zoom,p="function"==typeof t?t.apply(e,s):t,f=h(c.invert(u).concat(l/c.k),p.invert(u).concat(l/p.k));return function(e){if(1===e)e=p;else{var t=f(e),n=l/t[2];e=new ii(n,u[0]-t[0]*n,u[1]-t[1]*n)}a.zoom(null,e)}})}function x(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function k(e,...t){if(r.apply(this,arguments)){var n=x(this,t).event(e),i=this.__zoom,o=Math.max(u[0],Math.min(u[1],i.k*Math.pow(2,a.apply(this,arguments)))),c=kt(e);if(n.wheel)n.mouse[0][0]===c[0]&&n.mouse[0][1]===c[1]||(n.mouse[1]=i.invert(n.mouse[0]=c)),clearTimeout(n.wheel);else{if(i.k===o)return;n.mouse=[c,i.invert(c)],In(this),n.start()}oi(e),n.wheel=setTimeout(h,150),n.zoom("mouse",s(m(y(i,o),n.mouse[0],n.mouse[1]),n.extent,l))}function h(){n.wheel=null,n.end()}}function R(e,...t){if(!n&&r.apply(this,arguments)){var i=e.currentTarget,a=x(this,t,!0).event(e),o=wt(e.view).on("mousemove.zoom",p,!0).on("mouseup.zoom",f,!0),u=kt(e,i),c=e.clientX,h=e.clientY;It(e.view),ai(e),a.mouse=[u,this.__zoom.invert(u)],In(this),a.start()}function p(e){if(oi(e),!a.moved){var t=e.clientX-c,n=e.clientY-h;a.moved=t*t+n*n>d}a.event(e).zoom("mouse",s(m(a.that.__zoom,a.mouse[0]=kt(e,i),a.mouse[1]),a.extent,l))}function f(e){o.on("mousemove.zoom mouseup.zoom",null),Nt(e.view,a.moved),oi(e),a.event(e).end()}}function q(e,...t){if(r.apply(this,arguments)){var n=this.__zoom,a=kt(e.changedTouches?e.changedTouches[0]:e,this),o=n.invert(a),u=n.k*(e.shiftKey?.5:2),h=s(m(y(n,u),a,o),i.apply(this,t),l);oi(e),c>0?wt(this).transition().duration(c).call(v,h,a,e):wt(this).call(_.transform,h,a,e)}}function S(n,...i){if(r.apply(this,arguments)){var s,a,o,u,l=n.touches,c=l.length,h=x(this,i,n.changedTouches.length===c).event(n);for(ai(n),a=0;a<c;++a)u=[u=kt(o=l[a],this),this.__zoom.invert(u),o.identifier],h.touch0?h.touch1||h.touch0[2]===u[2]||(h.touch1=u,h.taps=0):(h.touch0=u,s=!0,h.taps=1+!!e);e&&(e=clearTimeout(e)),s&&(h.taps<2&&(t=u[0],e=setTimeout(function(){e=null},f)),In(this),h.start())}}function T(e,...t){if(this.__zooming){var n,r,i,a,o=x(this,t).event(e),u=e.changedTouches,c=u.length;for(oi(e),n=0;n<c;++n)i=kt(r=u[n],this),o.touch0&&o.touch0[2]===r.identifier?o.touch0[0]=i:o.touch1&&o.touch1[2]===r.identifier&&(o.touch1[0]=i);if(r=o.that.__zoom,o.touch1){var h=o.touch0[0],p=o.touch0[1],f=o.touch1[0],d=o.touch1[1],g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g,_=(_=d[0]-p[0])*_+(_=d[1]-p[1])*_;r=y(r,Math.sqrt(g/_)),i=[(h[0]+f[0])/2,(h[1]+f[1])/2],a=[(p[0]+d[0])/2,(p[1]+d[1])/2]}else{if(!o.touch0)return;i=o.touch0[0],a=o.touch0[1]}o.zoom("touch",s(m(r,i,a),o.extent,l))}}function I(e,...r){if(this.__zooming){var i,s,a=x(this,r).event(e),o=e.changedTouches,u=o.length;for(ai(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},f),i=0;i<u;++i)s=o[i],a.touch0&&a.touch0[2]===s.identifier?delete a.touch0:a.touch1&&a.touch1[2]===s.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(s=kt(s,this),Math.hypot(t[0]-s[0],t[1]-s[1])<g)){var l=wt(this).on("dblclick.zoom");l&&l.apply(this,arguments)}}}return _.transform=function(e,t,n,r){var i=e.selection?e.selection():e;i.property("__zoom",ci),e!==i?v(e,t,n,r):i.interrupt().each(function(){x(this,arguments).event(r).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},_.scaleBy=function(e,t,n,r){_.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,r)},_.scaleTo=function(e,t,n,r){_.transform(e,function(){var e=i.apply(this,arguments),r=this.__zoom,a=null==n?b(e):"function"==typeof n?n.apply(this,arguments):n,o=r.invert(a),u="function"==typeof t?t.apply(this,arguments):t;return s(m(y(r,u),a,o),e,l)},n,r)},_.translateBy=function(e,t,n,r){_.transform(e,function(){return s(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),l)},null,r)},_.translateTo=function(e,t,n,r,a){_.transform(e,function(){var e=i.apply(this,arguments),a=this.__zoom,o=null==r?b(e):"function"==typeof r?r.apply(this,arguments):r;return s(si.translate(o[0],o[1]).scale(a.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,l)},r,a)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=wt(this.that).datum();p.call(e,this.that,new ri(e,{sourceEvent:this.sourceEvent,target:_,type:e,transform:this.that.__zoom,dispatch:p}),t)}},_.wheelDelta=function(e){return arguments.length?(a="function"==typeof e?e:ni(+e),_):a},_.filter=function(e){return arguments.length?(r="function"==typeof e?e:ni(!!e),_):r},_.touchable=function(e){return arguments.length?(o="function"==typeof e?e:ni(!!e),_):o},_.extent=function(e){return arguments.length?(i="function"==typeof e?e:ni([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),_):i},_.scaleExtent=function(e){return arguments.length?(u[0]=+e[0],u[1]=+e[1],_):[u[0],u[1]]},_.translateExtent=function(e){return arguments.length?(l[0][0]=+e[0][0],l[1][0]=+e[1][0],l[0][1]=+e[0][1],l[1][1]=+e[1][1],_):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},_.constrain=function(e){return arguments.length?(s=e,_):s},_.duration=function(e){return arguments.length?(c=+e,_):c},_.interpolate=function(e){return arguments.length?(h=e,_):h},_.on=function(){var e=p.on.apply(p,arguments);return e===p?_:e},_.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,_):Math.sqrt(d)},_.tapDistance=function(e){return arguments.length?(g=+e,_):g},_}().scaleExtent([this.sliderConfig.min,this.sliderConfig.max]).on("zoom",t=>{const n=t.transform,r=this._roundToNearestScaleStep(n.k);e.attr("transform",n),this._sliderInput.nativeElement.value=r,this._sliderInputLabel.nativeElement.innerText=r+"x",this.sliderConfig.value=r}),t.call(this._zoomBehaviour)}_filterNodesById(e,t){return e.filter(e=>e.id===t)[0]}_filterNodesByType(e,t){return e.filter(e=>e.type===t)}_getContainerWidth(e){return e&&e.nativeElement?e.nativeElement.clientWidth:null}_getContainerHeight(e){return e&&e.nativeElement?e.nativeElement.clientHeight:null}_nodeRadius(e){if(!e)return null;let t=8;return-1!==e.label.indexOf("_:")?t--:e.instance||-1!==e.label.indexOf("inst:")?t+2:e.owlClass||-1!==e.label.indexOf("inst:")?t++:t}_roundToNearestScaleStep(e){const t=this.sliderConfig.step;return n=e,i=t,r=Math.floor(i)===i?0:i.toString().split(".")[1].length||0,Number(Math.round(Number(n+"e"+r))+"e-"+r);var n,r,i}_triplesToD3GraphData(e){if(!e)return;const t=new h;return e.map(e=>{const n=this.prefixPipe.transform(e.subject,d.short),r=this.prefixPipe.transform(e.predicate,d.short);let i=this.prefixPipe.transform(e.object,d.short);isNaN(i)||(i=Number(i)%1==0?String(Number(i)):String(Number(i).toFixed(2)));const s=new g(r,f.link);t.nodes.push(s);let a=this._filterNodesById(t.nodes,n),o=this._filterNodesById(t.nodes,i);null==a&&(a=new g(n,f.node),t.nodes.push(a)),null==o&&(o=new g(i,f.node),t.nodes.push(o)),!1===a.instance&&(a.instance=this._checkForRdfType(s)),!1===o.owlClass&&(o.owlClass=this._checkForRdfType(s)),t.links.push(new p(a,s)),t.links.push(new p(s,o)),t.nodeTriples.push(new _(a,s,o))}),t}_updateNodePositions(e){e.attr("cx",e=>e.x).attr("cy",e=>e.y)}_updateNodeTextPositions(e){e.attr("x",e=>e.x+12).attr("y",e=>e.y+3)}_updateLinkPositions(e){e.attr("d",e=>"M"+e.nodeSubject.x+","+e.nodeSubject.y+"S"+e.nodePredicate.x+","+e.nodePredicate.y+" "+e.nodeObject.x+","+e.nodeObject.y)}_updateLinkTextPositions(e){e.attr("x",e=>4+(e.nodeSubject.x+e.nodePredicate.x+e.nodeObject.x)/3).attr("y",e=>4+(e.nodeSubject.y+e.nodePredicate.y+e.nodeObject.y)/3)}};yi.ctorParameters=()=>[{type:J},{type:w}],yi.propDecorators={queryResultTriples:[{type:i.IIB}],height:[{type:i.IIB}],clickedNodeRequest:[{type:i.r_U}],_graphContainer:[{type:i.i9L,args:["graph",{static:!0}]}],_sliderInput:[{type:i.i9L,args:["sliderInput",{static:!0}]}],_sliderInputLabel:[{type:i.i9L,args:["sliderInputLabel",{static:!0}]}],onResize:[{type:i.L6J,args:["window:resize"]}]},yi=(0,r.gn)([(0,i.wA2)({selector:"awg-force-graph",template:'<div id="awg-force-graph-container" class="awg-forc-graph-panel-container" [ngStyle]="{ \'height.px\': height }" #graph>\n    <div class="awg-force-graph-icon-bar">\n        \x3c!-- Slider --\x3e\n        <div class="input-group input-group-sm awg-force-graph-zoom-slider-container float-left mb-3">\n            <div class="input-group-prepend">\n                <span #sliderInputLabel class="input-group-text" id="slider-label">{{ sliderConfig.value }}x</span>\n            </div>\n            <input\n                type="range"\n                #sliderInput\n                class="awg-force-graph-zoom-slider"\n                id="awg-force-graph-zoom-slider"\n                name="zoomSlider"\n                aria-label="Zoom slider"\n                aria-describedby="slider-label"\n                [min]="sliderConfig.min"\n                [max]="sliderConfig.max"\n                [step]="sliderConfig.step"\n                [(ngModel)]="sliderConfig.value"\n                (ngModelChange)="onZoomChange($event)"\n            />\n            <div class="input-group-append">\n                <button class="btn btn-sm btn-outline-info" type="submit" title="Reset" (click)="onReCenter()">\n                    <fa-icon [icon]="faCompressArrowsAlt"></fa-icon>\n                </button>\n            </div>\n        </div>\n\n        \x3c!-- Limit --\x3e\n        <div class="btn-group awg-force-graph-node-limit-container float-right my-auto" *ngIf="queryResultTriples">\n            <button type="button" class="btn btn-sm btn-outline-info" disabled aria-disabled="true">\n                <span *ngIf="limit < queryResultTriples.length">{{ limit }} von </span\n                >{{ queryResultTriples.length }} Triples\n            </button>\n            <div\n                class="btn-group"\n                ngbDropdown\n                container="body"\n                role="group"\n                aria-label="Button group with nested dropdown for node limit"\n            >\n                <button\n                    class="btn btn-sm btn-info dropdown-toggle-split"\n                    ngbDropdownToggle\n                    [disabled]="queryResultTriples.length === 0"\n                ></button>\n                <div class="dropdown-menu" ngbDropdownMenu>\n                    <ng-container *ngFor="let limitValue of limitValues">\n                        <button\n                            *ngIf="queryResultTriples.length > limitValue"\n                            class="dropdown-item"\n                            (click)="onLimitValueChange(limitValue)"\n                        >\n                            <span>{{ limitValue }}</span>\n                        </button>\n                    </ng-container>\n                    <button class="dropdown-item" (click)="onLimitValueChange(queryResultTriples.length)">\n                        <span>Kein Limit</span>\n                    </button>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- <span *ngIf="message" class="message">{{message}}</span> --\x3e\n    </div>\n</div>\n',styles:["#awg-force-graph-container {\n    position: relative;\n    width: 100%;\n}\n\n#awg-force-graph-container > .awg-force-graph-icon-bar {\n    position: relative;\n    width: 100%;\n}\n\n.awg-force-graph-panel-container {\n    position: inherit;\n    height: 100%;\n}\n\n/* slider */\n\n.input-group.awg-force-graph-zoom-slider-container {\n    flex-wrap: nowrap;\n    width: auto;\n}\n\n#slider-label.input-group-text {\n    width: 50px;\n    color: rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n}\n\n/* slider input */\n\ninput[type='range'].awg-force-graph-zoom-slider {\n    width: 100%;\n    margin: 6px 0;\n    background-color: transparent;\n    -webkit-appearance: none;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider:focus {\n    outline: none;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-webkit-slider-runnable-track {\n    background: rgba(221, 221, 221, 0.78);\n    border: 0.2px solid #dddddd;\n    border-radius: 1.3px;\n    width: 100%;\n    height: 31px;\n    cursor: pointer;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-webkit-slider-thumb {\n    margin-top: -6.7px;\n    width: 15px;\n    height: 30px;\n    background: rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border: 1.8px solid rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border-radius: 10px;\n    cursor: pointer;\n    -webkit-appearance: none;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider:focus::-webkit-slider-runnable-track {\n    background: #e5e5e5;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-moz-range-track {\n    background: rgba(221, 221, 221, 0.78);\n    border: 0.2px solid #dddddd;\n    border-radius: 1.3px;\n    width: 100%;\n    height: 31px;\n    cursor: pointer;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-moz-range-thumb {\n    width: 15px;\n    height: 30px;\n    background: rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border: 1.8px solid rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border-radius: 10px;\n    cursor: pointer;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-ms-track {\n    background: transparent;\n    border-color: transparent;\n    border-width: 7.4px 0;\n    color: transparent;\n    width: 100%;\n    height: 31px;\n    height: 31px;\n    cursor: pointer;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-ms-fill-lower {\n    background: #d5d5d5;\n    border: 0.2px solid #dddddd;\n    border-radius: 2.6px;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-ms-fill-upper {\n    background: rgba(221, 221, 221, 0.78);\n    border: 0.2px solid #dddddd;\n    border-radius: 2.6px;\n}\n\ninput[type='range'].awg-force-graph-zoom-slider::-ms-thumb {\n    width: 15px;\n    height: 30px;\n    background: rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border: 1.8px solid rgba(20, 155, 158, 1); /* rgba converted HEX #149b9e */\n    border-radius: 10px;\n    cursor: pointer;\n    margin-top: 0px;\n    /*Needed to keep the Edge thumb centred*/\n}\n\ninput[type='range'].awg-force-graph-zoom-slider:focus::-ms-fill-lower {\n    background: rgba(221, 221, 221, 0.78);\n}\n\ninput[type='range'].awg-force-graph-zoom-slider:focus::-ms-fill-upper {\n    background: #e5e5e5;\n}\n\n/* Simulation nodes */\n\n:host ::ng-deep .node {\n    stroke: #fff;\n    fill: #ddd;\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .blank {\n    stroke: #fff;\n    fill: #000 !important;\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .blank.instance {\n    stroke: #fff;\n    fill: #000;\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .class {\n    stroke: #fff;\n    fill: rgb(158, 0, 0);\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .instance {\n    stroke: #fff;\n    fill: rgb(32, 178, 170);\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .instance-space {\n    stroke: #fff;\n    fill: rgb(0, 191, 255);\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .instance-spaceType {\n    stroke: #fff;\n    fill: rgb(0, 0, 139);\n    stroke-width: 1.5px;\n}\n\n:host ::ng-deep .link {\n    fill: none;\n    stroke: #999;\n    stroke-opacity: 0.6;\n    stroke-width: 1px;\n}\n\n:host ::ng-deep marker {\n    stroke: #999;\n    fill: rgba(124, 240, 10, 0);\n}\n\n:host ::ng-deep .node-text {\n    font: 15px Roboto;\n    fill: black;\n}\n\n:host ::ng-deep .link-text {\n    font: 13px Roboto;\n    fill: grey;\n}\n"]})],yi);let mi=class{constructor(){this.clickedTableRequest=new i.vpe}ngOnInit(){}isNotEmpty(e){if(e.head&&e.body)return e.head.vars.length>0&&e.body.bindings.length>0}onTableNodeClick(e){e&&this.clickedTableRequest.emit(e)}};mi.propDecorators={queryResult$:[{type:i.IIB}],queryTime:[{type:i.IIB}],clickedTableRequest:[{type:i.r_U}]},mi=(0,r.gn)([(0,i.wA2)({selector:"awg-select-results",template:'<ngb-accordion activeIds="awg-graph-visualizer-select-result">\n    <ngb-panel id="awg-graph-visualizer-select-result" title="Resultat">\n        <ng-template ngbPanelContent>\n            <ng-container *ngIf="queryResult$ | async as queryResult; else loading">\n                <ng-container *ngIf="isNotEmpty(queryResult); else noResult">\n                    \x3c!-- SPARQL table visualization --\x3e\n                    <awg-sparql-table\n                        [queryResult]="queryResult"\n                        [queryTime]="queryTime"\n                        (clickedTableRequest)="onTableNodeClick($event)"\n                    >\n                    </awg-sparql-table>\n                </ng-container>\n                <ng-template #noResult>\n                    <awg-sparql-no-results></awg-sparql-no-results>\n                </ng-template>\n            </ng-container>\n            <ng-template #loading>\n                <awg-twelve-tone-spinner></awg-twelve-tone-spinner>\n            </ng-template>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:i.n4l.OnPush,styles:[""]})],mi);n(6917);let bi=class{constructor(){this.performQueryRequest=new i.vpe,this.resetQueryRequest=new i.vpe,this.updateQueryStringRequest=new i.vpe,this.cmSparqlConfig={lineNumbers:!0,firstLineNumber:1,lineWrapping:!0,matchBrackets:!0,mode:"sparql"}}ngOnInit(){}isExampleQueriesEnabled(){return!!(this.query&&this.query.queryLabel&&this.query.queryString&&this.queryList)}onEditorInputChange(e){e&&this.updateQueryStringRequest.emit(e)}onQueryListChange(e){e&&this.queryList&&(e=this.queryList.find(t=>e===t)||this.queryList[0],this.resetQuery(e))}performQuery(){this.performQueryRequest.emit()}resetQuery(e){e&&this.resetQueryRequest.emit(e)}preventPanelCollapseOnFullscreen(e){this.isFullscreen&&!1===e.nextState&&e.preventDefault()}togglePanel(){return this.isFullscreen?"awg-graph-visualizer-query":""}};bi.propDecorators={sparqlAcc:[{type:i.i9L,args:["sparqlAcc"]}],queryList:[{type:i.IIB}],query:[{type:i.IIB}],isFullscreen:[{type:i.IIB}],performQueryRequest:[{type:i.r_U}],resetQueryRequest:[{type:i.r_U}],updateQueryStringRequest:[{type:i.r_U}]},bi=(0,r.gn)([(0,i.wA2)({selector:"awg-sparql-editor",template:'<ngb-accordion\n    #sparqlAcc="ngbAccordion"\n    [activeIds]="togglePanel()"\n    (panelChange)="preventPanelCollapseOnFullscreen($event)"\n>\n    <ngb-panel id="awg-graph-visualizer-query">\n        <ng-template ngbPanelHeader>\n            <div class="d-flex align-items-center justify-content-between">\n                <button ngbPanelToggle class="btn btn-link text-left panel-btn">SPARQL Abfrage</button>\n\n                \x3c!-- Example Query Handle --\x3e\n                <div class="btn-group float-right mr-2" *ngIf="isExampleQueriesEnabled()">\n                    <button type="button" class="btn btn-sm btn-outline-info" disabled aria-disabled="true">\n                        Beispielabfragen\n                    </button>\n                    <div\n                        class="btn-group"\n                        ngbDropdown\n                        container="body"\n                        placement="bottom-right"\n                        role="group"\n                        aria-label="Button group with nested dropdown for sample queries"\n                    >\n                        <button class="btn btn-sm btn-info dropdown-toggle-split" ngbDropdownToggle></button>\n                        <div class="dropdown-menu" ngbDropdownMenu>\n                            <ng-container *ngFor="let q of queryList">\n                                <button\n                                    class="dropdown-item"\n                                    [class.disabled]="q === query"\n                                    (click)="onQueryListChange(q)"\n                                >\n                                    <span>{{ q.queryLabel }}</span>\n                                </button>\n                            </ng-container>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </ng-template>\n        <ng-template ngbPanelContent>\n            \x3c!-- CodeMirror editor instance --\x3e\n            <ngx-codemirror\n                [(ngModel)]="query.queryString"\n                (ngModelChange)="onEditorInputChange($event)"\n                [options]="cmSparqlConfig"\n            >\n            </ngx-codemirror>\n\n            \x3c!-- Handle buttons --\x3e\n            <div fxLayout="row" class="mt-2">\n                <button class="btn btn-info" (click)="performQuery()">Query</button>\n                <button class="btn btn-outline-info" (click)="resetQuery(query)">Reset</button>\n            </div>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:i.n4l.OnPush,styles:["ngx-codemirror ::ng-deep .CodeMirror {\n    font-size: initial;\n}\n"]})],bi);var vi=n(4544);let xi=class{constructor(e){this.coreService=e}ngOnInit(){this.provideMetaData()}provideMetaData(){this.logos=this.coreService.getLogos()}};xi.ctorParameters=()=>[{type:vi.pX}],xi=(0,r.gn)([(0,i.wA2)({selector:"awg-sparql-no-results",template:'<div class="text-center">\n    <p>Entschuldigung, Ihre SPARQL-Anfrage f\xfchrte leider zu keinem Ergebnis.</p>\n    <p>M\xf6glicherweise k\xf6nnen Sie Ihre Anfrage anpassen.</p>\n    <p>\n        Ausf\xfchrliche Informationen zu SPARQL finden Sie unter:\n        <a href="{{ logos.sparql.href }}">{{ logos.sparql.href }}</a\n        >.\n    </p>\n    <p>\n        <a href="{{ logos.sparql.href }}">\n            <img width="33%" src="{{ logos.sparql.src }}" alt="{{ logos.sparql.alt }}" />\n        </a>\n    </p>\n</div>\n',changeDetection:i.n4l.OnPush,styles:[""]})],xi);var wi=n(8002);let ki=class{constructor(){this.clickedTableRequest=new i.vpe,this.faSortUp=c.foy,this.faSortDown=c.u9C,this.tableOptions={selectedKey:"",sortKey:"",sortIcon:this.faSortDown,reverse:!1,case:m.CASE_INSENSITIVE}}ngOnInit(){this._initTable()}onPageSizeChange(e){this.queryResult&&(this.tableData.paginatedRows$=this._paginateRows(e))}onSort(e){e&&(this.tableOptions.selectedKey===e&&(this.tableOptions.reverse=!this.tableOptions.reverse),this.tableOptions.sortIcon=this.tableOptions.reverse?this.faSortUp:this.faSortDown,this.tableOptions.selectedKey=e,this.tableOptions.sortKey=this.tableOptions.selectedKey.toString()+".label")}onTableNodeClick(e){e&&this.clickedTableRequest.emit(e)}_initTable(){this.tableData=new v(this.queryResult),this.paginatorOptions=new x(1,10,[5,10,25,50,100,200],this.queryResult.body.bindings.length),this.searchFilter="",this.onSort(this.tableData.header[0]),this.onPageSizeChange(this.searchFilter)}_paginateRows(e){return this.tableData.totalRows$.pipe((0,wi.U)(t=>{const n=e.toString().toLowerCase();return this.tableData.filteredRows=t.filter(e=>Object.values(e).some(e=>null!=e&&(e.label&&e.label.toString().toLowerCase().includes(n)))),this.tableData.filteredRows}),(0,wi.U)(e=>{const t=(this.paginatorOptions.page-1)*this.paginatorOptions.pageSize,n=t+this.paginatorOptions.pageSize,r=n-t;return e.length<=r?e:e.slice(t,n)}))}};ki.propDecorators={queryResult:[{type:i.IIB}],queryTime:[{type:i.IIB}],clickedTableRequest:[{type:i.r_U}]},ki=(0,r.gn)([(0,i.wA2)({selector:"awg-sparql-table",template:'<form *ngIf="tableData.filteredRows">\n    <div class="form-group form-inline">\n        <label class="col-sm-4 col-form-label"\n            >SELECT Anfrage <br />\n            ({{ tableData.filteredRows?.length }} von {{ (tableData.totalRows$ | async).length }} Ergebnissen)</label\n        >\n        <div class="col-sm-6">\n            <input\n                id="search"\n                class="form-control ml-2"\n                type="text"\n                name="searchFilter"\n                [(ngModel)]="searchFilter"\n                (ngModelChange)="onPageSizeChange(searchFilter)"\n                placeholder="Ergebnisse filtern..."\n            />\n        </div>\n    </div>\n</form>\n\n<div class="d-flex justify-content-between p-2" *ngIf="tableData.filteredRows">\n    \x3c!-- top pagination --\x3e\n    <ngb-pagination\n        class="d-flex justify-content-center cols-xs-2"\n        [(page)]="paginatorOptions.page"\n        [pageSize]="paginatorOptions.pageSize"\n        [collectionSize]="tableData.filteredRows?.length"\n        [maxSize]="4"\n        [boundaryLinks]="true"\n        (pageChange)="onPageSizeChange(searchFilter)"\n    >\n    </ngb-pagination>\n\n    <select\n        class="custom-select"\n        style="width: auto"\n        [(ngModel)]="paginatorOptions.pageSize"\n        (ngModelChange)="onPageSizeChange(searchFilter)"\n    >\n        <option *ngFor="let option of paginatorOptions.pageSizeOptions" [ngValue]="option">\n            {{ option }} Ergebnisse pro Seite\n        </option>\n    </select>\n</div>\n\n<table class="table table-striped" *ngIf="tableData?.paginatedRows$ | async as paginatedRows; else loading">\n    <thead>\n        <tr>\n            <th scope="col" *ngFor="let headerLabel of tableData?.header" (click)="onSort(headerLabel)">\n                {{ headerLabel }}&nbsp;<fa-icon\n                    *ngIf="headerLabel === tableOptions.selectedKey"\n                    [icon]="tableOptions.sortIcon"\n                ></fa-icon>\n            </th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr\n            *ngFor="\n                let row of paginatedRows | orderBy: tableOptions.sortKey:tableOptions.reverse:tableOptions.case;\n                index as i;\n                trackBy: i\n            "\n        >\n            <td scope="col" *ngFor="let headerLabel of tableData.header; index as j; trackBy: j">\n                <a\n                    *ngIf="row[headerLabel].type && row[headerLabel].type == \'uri\'"\n                    (click)="onTableNodeClick(row[headerLabel].value)"\n                >\n                    <ngb-highlight [result]="row[headerLabel].label" [term]="searchFilter"></ngb-highlight>\n                </a>\n                <span *ngIf="row[headerLabel].type != \'uri\'"\n                    ><ngb-highlight [result]="row[headerLabel].label" [term]="searchFilter"></ngb-highlight\n                ></span>\n            </td>\n        </tr>\n    </tbody>\n</table>\n<ng-template #loading>\n    <awg-twelve-tone-spinner></awg-twelve-tone-spinner>\n</ng-template>\n\n<div class="d-flex justify-content-between p-2" *ngIf="tableData.filteredRows">\n    \x3c!-- bottom pagination --\x3e\n    <ngb-pagination\n        class="d-flex justify-content-center"\n        [(page)]="paginatorOptions.page"\n        [pageSize]="paginatorOptions.pageSize"\n        [collectionSize]="tableData.filteredRows?.length"\n        [maxSize]="4"\n        [boundaryLinks]="true"\n        (pageChange)="onPageSizeChange(searchFilter)"\n    >\n    </ngb-pagination>\n\n    <select\n        class="custom-select"\n        style="width: auto"\n        [(ngModel)]="paginatorOptions.pageSize"\n        (ngModelChange)="onPageSizeChange(searchFilter)"\n    >\n        <option *ngFor="let option of paginatorOptions.pageSizeOptions" [ngValue]="option">\n            {{ option }} Ergebnisse pro Seite\n        </option>\n    </select>\n</div>\n',changeDetection:i.n4l.OnPush,styles:["ngb-highlight ::ng-deep .ngb-highlight {\n    font-weight: 700;\n    background: yellow;\n}\n"]})],ki);n(1006);let Ri=class{constructor(){this.performQueryRequest=new i.vpe,this.resetTriplesRequest=new i.vpe,this.updateTriplesRequest=new i.vpe,this.cmTriplesConfig={lineNumbers:!0,firstLineNumber:1,lineWrapping:!0,matchBrackets:!0,mode:"turtle"}}ngOnInit(){}onEditorInputChange(e){e&&this.updateTriplesRequest.emit(e)}performQuery(){this.performQueryRequest.emit()}resetTriples(){this.resetTriplesRequest.emit()}preventPanelCollapseOnFullscreen(e){this.isFullscreen&&!1===e.nextState&&e.preventDefault()}togglePanel(){return this.isFullscreen?"awg-graph-visualizer-triples":""}};Ri.propDecorators={triplesAcc:[{type:i.i9L,args:["triplesAcc"]}],triples:[{type:i.IIB}],isFullscreen:[{type:i.IIB}],performQueryRequest:[{type:i.r_U}],resetTriplesRequest:[{type:i.r_U}],updateTriplesRequest:[{type:i.r_U}]},Ri=(0,r.gn)([(0,i.wA2)({selector:"awg-triples-editor",template:'<ngb-accordion\n    #triplesAcc="ngbAccordion"\n    [activeIds]="togglePanel()"\n    (panelChange)="preventPanelCollapseOnFullscreen($event)"\n>\n    <ngb-panel id="awg-graph-visualizer-triples" title="RDF Triples">\n        <ng-template ngbPanelContent>\n            \x3c!-- CodeMirror editor instance --\x3e\n            <ngx-codemirror\n                [(ngModel)]="triples"\n                (ngModelChange)="onEditorInputChange($event)"\n                [options]="cmTriplesConfig"\n            >\n            </ngx-codemirror>\n\n            \x3c!-- Handle buttons --\x3e\n            <div fxLayout="row" class="mt-2">\n                <button class="btn btn-info" (click)="performQuery()">Query</button>\n                <button class="btn btn-outline-info" (click)="resetTriples()">Reset</button>\n            </div>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:i.n4l.OnPush,styles:["ngx-codemirror ::ng-deep .CodeMirror {\n    font-size: initial;\n}\n"]})],Ri);let qi=class{ngOnInit(){}};function Si(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(l){return void n(l)}o.done?t(u):Promise.resolve(u).then(r,i)}qi.propDecorators={queryType:[{type:i.IIB}]},qi=(0,r.gn)([(0,i.wA2)({selector:"awg-unsupported-type-results",template:'<ngb-accordion activeIds="awg-graph-visualizer-unsupported-query-type-result">\n    <ngb-panel id="awg-graph-visualizer-unsupported-query-type-result" title="Resultat">\n        <ng-template ngbPanelContent>\n            <p class="text-center">\n                Sorry, but the requested SPARQL query type {{ queryType | uppercase }} is not supported yet.\n            </p>\n            <p class="text-center">Please try a CONSTRUCT or SELECT query instead.</p>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:i.n4l.OnPush,styles:[""]})],qi);var Ti=n(4402),Ii=n(9193);let Ni=class{constructor(e,t){this.graphVisualizerService=e,this.toastService=t,this.defaultForceGraphHeight=500}ngOnInit(){this.resetTriples(),this.resetQuery()}resetTriples(){this.graphRDFInputData.triples&&(this.triples=this.graphRDFInputData.triples)}resetQuery(e){this.graphRDFInputData.queryList&&(this.queryList=JSON.parse(JSON.stringify(this.graphRDFInputData.queryList)),this.query=e?this.queryList.find(t=>e.queryLabel===t.queryLabel)||e:this.queryList[0],this.performQuery())}performQuery(){if(-1===this.query.queryString.toLowerCase().indexOf("prefix")&&(this.query.queryString=this.graphVisualizerService.appendNamespacesToQuery(this.query.queryString,this.triples)),this.queryType=this.graphVisualizerService.getQuerytype(this.query.queryString),"construct"===this.queryType||"select"===this.queryType){const e=this._queryLocalStore(this.queryType,this.query.queryString,this.triples);this.queryResult$=(0,Ti.D)(e)}else this.queryResult$=Ii.E}onGraphNodeClick(e){e&&console.info("GraphVisualizerComponent# graphClick on node",e)}onTableNodeClick(e){e&&console.info("GraphVisualizerComponent# tableClick on URI",e)}showErrorMessage(e,t,n){t&&(n||(n=7e3),console.error(t,n),this.toastService.show(t,{header:e,classname:"bg-danger text-light",delay:n}))}_queryLocalStore(e,t,n){var r,i=this;return(r=function*(){const r=Date.now();let s;try{s=yield i.graphVisualizerService.doQuery(e,t,n),i.queryTime=Date.now()-r}catch(a){console.error("#queryLocalstore got error:",a),a.message&&a.name&&(-1!==a.message.indexOf("undefined")&&(yield i.showErrorMessage(a.name,"The query did not return any results",1e4)),yield i.showErrorMessage(a.name,a.message,1e4)),i.queryTime=Date.now()-r,s=[]}return s},function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function a(e){Si(s,n,i,a,o,"next",e)}function o(e){Si(s,n,i,a,o,"throw",e)}a(void 0)})})()}};Ni.ctorParameters=()=>[{type:J},{type:vi.kl}],Ni.propDecorators={fs:[{type:i.i9L,args:["fs"]}],graphRDFInputData:[{type:i.IIB}],isFullscreen:[{type:i.IIB}]},Ni=(0,r.gn)([(0,i.wA2)({selector:"awg-graph-visualizer",template:'\x3c!-- Data: Triples, SPARQL query, result --\x3e\n\n<div #fs class="row" [class.is-fullscreen]="isFullscreen" *ngIf="graphRDFInputData">\n    <ng-container *ngIf="!isFullscreen">\n        \x3c!-- awg-graph-triples-editor --\x3e\n        <div class="col-lg-6 pr-lg-0">\n            <awg-triples-editor\n                [triples]="triples"\n                (updateTriplesRequest)="triples = $event"\n                (resetTriplesRequest)="resetTriples()"\n                (performQueryRequest)="performQuery()"\n            ></awg-triples-editor>\n        </div>\n\n        \x3c!-- awg-graph-sparql-editor --\x3e\n        <div class="col-lg-6 pl-lg-0">\n            <awg-sparql-editor\n                [queryList]="queryList"\n                [query]="query"\n                (updateQueryStringRequest)="query.queryString = $event"\n                (resetQueryRequest)="resetQuery($event)"\n                (performQueryRequest)="performQuery()"\n            ></awg-sparql-editor>\n        </div>\n\n        \x3c!-- Results --\x3e\n        <div class="col-12">\n            \x3c!-- CONSTRUCT --\x3e\n            \x3c!-- awg-graph-construct-result --\x3e\n            <awg-construct-results\n                #queryConstructResultAcc\n                *ngIf="queryType === \'construct\'; else querySelectResultAcc"\n                [queryResult$]="queryResult$"\n                [defaultForceGraphHeight]="defaultForceGraphHeight"\n                (clickedNodeRequest)="onGraphNodeClick($event)"\n            ></awg-construct-results>\n\n            \x3c!-- SELECT --\x3e\n            \x3c!-- awg-graph-select-result --\x3e\n            <ng-template #querySelectResultAcc>\n                <awg-select-results\n                    *ngIf="queryType === \'select\'; else queryUnsupportedTypeAcc"\n                    [queryResult$]="queryResult$"\n                    (clickedTableRequest)="onTableNodeClick($event)"\n                ></awg-select-results>\n            </ng-template>\n\n            \x3c!-- OTHERS --\x3e\n            \x3c!-- awg-graph-unsupported-query-type-result --\x3e\n            <ng-template #queryUnsupportedTypeAcc>\n                <awg-unsupported-type-results [queryType]="queryType"></awg-unsupported-type-results>\n            </ng-template>\n        </div>\n    </ng-container>\n    <ng-container *ngIf="isFullscreen">\n        <div class="col-md-4 col-lg-3 px-0 awg-fullscreen">\n            \x3c!-- awg-graph-triples-editor --\x3e\n            <awg-triples-editor\n                [triples]="triples"\n                [isFullscreen]="isFullscreen"\n                (updateTriplesRequest)="triples = $event"\n                (resetTriplesRequest)="resetTriples()"\n                (performQueryRequest)="performQuery()"\n            ></awg-triples-editor>\n\n            \x3c!-- awg-graph-sparql-editor --\x3e\n            <awg-sparql-editor\n                [queryList]="queryList"\n                [query]="query"\n                [isFullscreen]="isFullscreen"\n                (updateQueryStringRequest)="query.queryString = $event"\n                (resetQueryRequest)="resetQuery($event)"\n                (performQueryRequest)="performQuery()"\n            ></awg-sparql-editor>\n        </div>\n\n        \x3c!-- Results --\x3e\n        <div class="col-md-8 col-lg-9 px-0 awg-fullscreen">\n            \x3c!-- CONSTRUCT --\x3e\n            \x3c!-- awg-graph-construct-result --\x3e\n            <awg-construct-results\n                #queryConstructResultAcc\n                *ngIf="queryType === \'construct\'; else querySelectResultAcc"\n                [queryResult$]="queryResult$"\n                [defaultForceGraphHeight]="1000"\n                (clickedNodeRequest)="onGraphNodeClick($event)"\n            ></awg-construct-results>\n\n            \x3c!-- SELECT --\x3e\n            \x3c!-- awg-graph-select-result --\x3e\n            <ng-template #querySelectResultAcc>\n                <awg-select-results\n                    *ngIf="queryType === \'select\'; else queryUnsupportedTypeAcc"\n                    [queryResult$]="queryResult$"\n                    [queryTime]="queryTime"\n                    (clickedTableRequest)="onTableNodeClick($event)"\n                ></awg-select-results>\n            </ng-template>\n\n            \x3c!-- OTHERS --\x3e\n            \x3c!-- awg-graph-unsupported-query-type-result --\x3e\n            <ng-template #queryUnsupportedTypeAcc>\n                <awg-unsupported-type-results [queryType]="queryType"></awg-unsupported-type-results>\n            </ng-template>\n        </div>\n    </ng-container>\n</div>\n\n<awg-toast aria-live="polite" aria-atomic="true"></awg-toast>\n',changeDetection:i.n4l.Default,styles:[".awg-fullscreen ::ng-deep .collapse.show {\n    height: 100vh;\n}\n\n.awg-fullscreen ::ng-deep #awg-graph-visualizer-triples.collapse.show {\n    height: 45vh;\n}\n\n.awg-fullscreen ::ng-deep #awg-graph-visualizer-query.collapse.show {\n    height: 50vh;\n}\n"]})],Ni);let Ei=class{};Ei=(0,r.gn)([(0,i.LVF)({imports:[s.m],declarations:[a,yi,Ni,w,mi,bi,xi,ki,Ri,qi],exports:[Ni],providers:[J,w]})],Ei);var Ci=n(4213);var zi=n(8583),Fi=n(3190),Ai=n(5304),Pi=n(5768),Di=n(6409);let Mi=class{constructor(e,t,n){this.editionDataService=e,this.editionService=t,this.document=n,this.isFullscreen=!1,this.faExpand=c.TL5,this.faCompress=c.Qj4,this.GRAPH_IMAGES={OP12:"",OP25:Pi.w8.GRAPH_IMAGE_OP25.route},this.errorObject=null,this.ref=this}onKeydownHandler(e){this.document.fullscreenElement||this.document.mozFullScreenElement||this.document.webkitFullscreenElement||(this.isFullscreen=!1)}ngOnInit(){this.getEditionGraphData()}getEditionGraphData(){this.editionGraphData$=this.editionService.getEditionWork().pipe((0,Fi.w)(e=>(this.editionWork=e,this.editionDataService.getEditionGraphData(this.editionWork))),(0,Ai.K)(e=>(this.errorObject=e,Ii.E)))}openFullscreen(){const e=this.child.fs.nativeElement;this.isFullscreen=!0,this.document.fullscreenElement||this.document.mozFullScreenElement||this.document.webkitFullscreenElement||(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}closeFullscreen(){this.document.exitFullscreen?this.document.exitFullscreen():this.document.mozCancelFullScreen?this.document.mozCancelFullScreen():this.document.webkitExitFullscreen?this.document.webkitExitFullscreen():this.document.msExitFullscreen&&this.document.msExitFullscreen(),this.isFullscreen=!1}};Mi.ctorParameters=()=>[{type:Di.K},{type:Di.O},{type:void 0,decorators:[{type:i.tBr,args:[zi.K0]}]}],Mi.propDecorators={child:[{type:i.i9L,args:[Ni]}],isFullscreen:[{type:i.pfw,args:["class.is-fullscreen"]}],onKeydownHandler:[{type:i.L6J,args:["document:fullscreenchange",["$event"]]}]},Mi=(0,r.gn)([(0,i.wA2)({selector:"awg-edition-graph",template:'\x3c!-- content: edition graph --\x3e\n<div>\n    \x3c!-- modal --\x3e\n    <awg-modal #modal></awg-modal>\n\n    \x3c!-- graph --\x3e\n    <div class="awg-graph-view" *ngIf="editionGraphData$ | async as editionGraphData; else error">\n        <div *ngFor="let graph of editionGraphData.graph">\n            \x3c!-- graph description --\x3e\n            <div class="awg-graph-description">\n                <p>\n                    So weit vorhanden, pr\xe4sentiert die vorliegende Ansicht Graph-Visualisierungen des ausgew\xe4hlten\n                    Editionsbereichs: Der <i>statische Graph</i> vermittelt dabei einen von den jeweiligen Editoren\n                    fixierten \xdcberblick editionsrelevanter Zusammenh\xe4nge und Abh\xe4ngigkeiten, der\n                    <i>dynamische Graph</i> bietet zus\xe4tzlich einen interaktiven Zugang zu dem zugrundeliegenden\n                    Datenbestand.\n                    <span class="text-danger"\n                        >Diese Funktionalit\xe4t ist noch nicht f\xfcr alle Skizzenbestandteile verf\xfcgbar, wird aber\n                        sukzessive erg\xe4nzt.</span\n                    >\n                </p>\n                <ng-container *ngIf="graph.description">\n                    <p\n                        *ngFor="let description of graph.description"\n                        [compile-html]="description"\n                        [compile-html-ref]="ref"\n                    ></p>\n                </ng-container>\n            </div>\n\n            \x3c!-- dynamic graph --\x3e\n            <div class="awg-graph-dynamic" *ngIf="graph.rdfData && graph.rdfData.triples && graph.rdfData.queryList">\n                <h4>\n                    Dynamischer Graph\n                    <button\n                        type="button"\n                        class="btn btn-sm btn-outline-info ml-2"\n                        (click)="modal.open(\'HINT_EDITION_GRAPH\')"\n                    >\n                        Hinweise zur Nutzung\n                    </button>\n                    <button\n                        type="button"\n                        title="Open fullscreen"\n                        class="btn btn-sm btn-outline-info ml-2"\n                        (click)="openFullscreen()"\n                        *ngIf="!isFullscreen"\n                    >\n                        <fa-icon [icon]="faExpand"></fa-icon>\n                    </button>\n                    <button\n                        type="button"\n                        title="Close fullscreen"\n                        class="btn btn-sm btn-info ml-2"\n                        (click)="closeFullscreen()"\n                        *ngIf="isFullscreen"\n                    >\n                        <fa-icon [icon]="faCompress"></fa-icon>\n                    </button>\n                </h4>\n                <p>\n                    Diese interaktive Visualisierung basiert auf Mads Holten\'s\n                    <a href="https://github.com/MadsHolten/sparql-visualizer">SPARQL Visualizer</a>. Sie modelliert den\n                    aktuellen Skizzenkomplex in Form eines <a href="https://www.w3.org/RDF/">RDF</a>-Graphen. Die\n                    zugrundeliegenden RDF-Daten sind unter dem Punkt <i>RDF Triples</i> einsehbar und lokal editierbar.\n                    Eine Filterung und Eingrenzung dieser RDF-Daten kann mithilfe der Abfragesprache\n                    <a href="https://www.w3.org/TR/sparql11-query/">SPARQL</a>\n                    unter dem Punkt <i>SPARQL Abfrage</i> vorgenommen werden; in der Voreinstellung werden hierbei alle\n                    vorhandenen Triples abgefragt.\n                </p>\n                <awg-graph-visualizer\n                    [graphRDFInputData]="graph.rdfData"\n                    [isFullscreen]="isFullscreen"\n                ></awg-graph-visualizer>\n            </div>\n\n            \x3c!-- static image --\x3e\n            <div class="awg-graph-static mt-3" *ngIf="graph.staticImage && graph.staticImage !== \'\'">\n                <h4>Statischer Graph</h4>\n                <div [compile-html]="graph.staticImage" [compile-html-ref]="ref"></div>\n            </div>\n        </div>\n    </div>\n\n    \x3c!-- error message --\x3e\n    <ng-template #error>\n        <div class="errorMessage" *ngIf="errorObject">\n            <div class="col-12 text-center">\n                <div class="alert alert-danger">{{ errorObject | json }}</div>\n            </div>\n        </div>\n    </ng-template>\n</div>\n',changeDetection:i.n4l.OnPush,styles:[""]})],Mi);const ji=[{path:"",component:Mi,data:{title:"AWG Online Edition \u2013 Graph"}}],Oi=[Mi];let Li=class{};Li=(0,r.gn)([(0,i.LVF)({imports:[Ci.Bz.forChild(ji)],exports:[Ci.Bz]})],Li);let $i=class{};$i=(0,r.gn)([(0,i.LVF)({imports:[s.m,Ei,Li],declarations:[Oi]})],$i)}}]);